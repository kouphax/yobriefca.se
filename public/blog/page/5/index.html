
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Yo Briefcase!</title>
  <meta name="author" content="James Hughes">

  
  <meta name="description" content="Busy busy busy. I&#8217;ve been working away on a lot of projects and not had a lot of time to stick anything up on this blog in a while. I&#8217;ve &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yobriefca.se/blog/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed" rel="alternate" title="Yo Briefcase!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19143623-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Yo Briefcase!</a></h1>
  
    <h2>All the codez!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yobriefca.se" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li><a href="/projects">Projects</a></li>
    <li><a href="/screencasts">Screencasts</a></li>
    <li><a href="/talks">Talks</a></li>
    <!--
    <li><a href="/cv">CV</a></li>
    -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/07/05/nspec-debuggershim/">Debugging NSpec Tests: The DebuggerShim</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-05T00:00:00+01:00" pubdate data-updated="true">Jul 5<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <p>Busy busy busy.  I&#8217;ve been working away on a lot of projects and not had a lot of time to stick anything up on this blog in a while.  I&#8217;ve got a growing &#8220;To Blog&#8221; list but no time to do it, woe is me!!!<br><img src="/images/woeisme.png" style="float:right;"></p><p>Enough about my perfectly normal life, well almost.  Some of my current work has me going full tilt with <span class="caps">TDD</span> on a little C# project and I decided that <a href="http://nspec.org">NSpec</a> would help me with unit testing.  So I went about writing failing tests, writing code, passing tests on and on and on.  Things went along fairly well until I hit a little bit of a wall around a little edge case.  My tests kept failing and I couldn&#8217;t understand why.  The stack trace made little to no sense and my code looked sound.  The problem I had was that <a href="http://nspec.org">NSpec</a>, out of the box at least, doesn&#8217;t have any nice integration with Visual Studio or TestDriven.<span class="caps">NET</span>.  Initially I was using a throw away console application and debugging through it but as you can imagine that was time consuming.</p><p>It wasn&#8217;t long though until I was pointed in the <a href="http://twitter.com/#!/amirrajan/status/87174922782253056">right direction</a>.</p><p><!-- http://twitter.com/#!/amirrajan/status/87174922782253056 --> <style type='text/css'>.bbpBox87174922782253056 {background:url(http://a0.twimg.com/images/themes/theme1/bg.png) #C0DEED;padding:20px;} p.bbpTweet{background:#fff;padding:10px 12px 10px 12px;margin:0;min-height:48px;color:#000;font-size:18px !important;line-height:22px;-moz-border-radius:5px;-webkit-border-radius:5px} p.bbpTweet span.metadata{display:block;width:100%;clear:both;margin-top:8px;padding-top:12px;height:40px;border-top:1px solid #fff;border-top:1px solid #e6e6e6} p.bbpTweet span.metadata span.author{line-height:19px} p.bbpTweet span.metadata span.author img{float:left;margin:0 7px 0 0px;width:38px;height:38px} p.bbpTweet a:hover{text-decoration:underline}p.bbpTweet span.timestamp{font-size:12px;display:block}</style> <div class='bbpBox87174922782253056'><p class='bbpTweet'>If you want to have debugger support for you NSpec specifications, use this: <a href="http://t.co/6SwZcVL" rel="nofollow">http://t.co/6SwZcVL</a> /cc @<a class="tweet-url username" href="http://twitter.com/kouphax" rel="nofollow">kouphax</a> @<a class="tweet-url username" href="http://twitter.com/mattflo" rel="nofollow">mattflo</a><span class='timestamp'><a title='Sat Jul 02 15:04:55 +0000 2011' href='http://twitter.com/#!/amirrajan/status/87174922782253056'>less than a minute ago</a> via web <a href='http://twitter.com/intent/favorite?tweet_id=87174922782253056'><img src='http://si0.twimg.com/images/dev/cms/intents/icons/favorite.png'> Favorite</a> <a href='http://twitter.com/intent/retweet?tweet_id=87174922782253056'><img src='http://si0.twimg.com/images/dev/cms/intents/icons/retweet.png'> Retweet</a> <a href='http://twitter.com/intent/tweet?in_reply_to=87174922782253056'><img src='http://si0.twimg.com/images/dev/cms/intents/icons/reply.png'> Reply</a></span><span class='metadata'><span class='author'><a href='http://twitter.com/amirrajan'><img src='http://a2.twimg.com/profile_images/1326219901/1613d80124a605829d755d9df0fc8b9e_normal.jpeg'></a><strong><a href='http://twitter.com/amirrajan'>Amir Rajan</a></strong><br>amirrajan</span></span></p></div> <!-- end of tweet --></p><p>The gist, in full below, provides a simple debugger shim over nspec that allows you to hook into the Visual Studio debugger (through something like TestDriven.<span class="caps">NET</span> for example).  I simply right clicked on the shim and select &#8220;Run With Debugger&#8221; and boom my stupid mistake was displayed to me rather quickly.</p><script src='https://gist.github.com/1065724.js?file=DebuggerShim.cs'></script><noscript><pre><code>using System;using NUnit.Framework;using NSpec.Domain;using System.Reflection;using NSpec;namespace DynamicBlog.Tests{    [TestFixture]    public class DebuggerShim    {        [Test]        public void debug()        {            //the specification class you want to test            //this can be a regular expression            var testClassYouWantToDebug = "describe_Blog";            //initialize NSpec's specfinder            var finder = new SpecFinder(                Assembly.GetExecutingAssembly().Location,                 new Reflector(),                 testClassYouWantToDebug);                        //initialize NSpec's builder            var builder = new ContextBuilder(                finder,                 new DefaultConventions());            //this line runs the tests you specified in the filter            new ContextRunner(builder).Run();        }    }}</code></pre></noscript><p>Handy until a more concrete solution appears.  One more thing &#8211; really enjoying nspec, it seems to be fitting well with the way I work.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/22/micro-web-frameworks-101-anna/">Micro Web Frameworks in .NET 101: Anna</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-22T00:00:00+01:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <blockquote class="announce">This post is the is part of series of posts covering the various <em>micro web frameworks</em> in the .<span class="caps">NET</span> world.  The frameworks I intend to cover will be linked as the series progresses.  For further discussion on the use of micro web framework in .<span class="caps">NET</span> please see my <a href="/blog/2011/05/18/why-use-micro-web-frameworks-in-net/">previous post</a> The current series line up:<ul>	<li><a href="/blog/2011/05/19/micro-web-frameworks-101-jessica/">Jessica</a></li>	<li><a href="/blog/2011/05/23/micro-web-frameworks-101-nancy/">Nancy</a></li>	<li><a href="/blog/2011/06/22/micro-web-frameworks-101-anna/">Anna</a></li>	<li><a href="/blog/2011/07/18/micro-web-frameworks-101-tinyweb//">Tinyweb</a><br></li></ul></blockquote><p>It&#8217;s been a while since I visited this subject (at least in my blog) and I&#8217;ve still to record a lot of screencasts around Nancy.  Anyway I thought I&#8217;d give a quick mention to <a href="https://github.com/jfromaniello/Anna/">Anna</a> that has just come up on my radar.  Now the project is still in the very early stages but it&#8217;s possibly one of the best uses of <a href="http://msdn.microsoft.com/en-us/data/gg577609">Rx</a> and worth a quick look.  Now I am a bit rusty in the old Rx stuff so sorry if I say something stupid.</p><h2>Getting Started &#8211; Hello World</h2><p><a href="https://github.com/jfromaniello/Anna/">Anna</a> aims to be an asynchronous event-driven <span class="caps">HTTP</span> server in a similar vein to <a href="http://nodejs.org/">node.js</a>.  At it&#8217;s core is the <code>HttpServer</code> object that allows us to wire up routes.</p><p>There is no configuration required &#8211; just install <a href="https://github.com/jfromaniello/Anna/">Anna</a>  from the Nuget Package Console via <code>Install-Package Anna</code> and you are good to go.  Just create a console application with the infamous <code>Program.cs</code> and a few lines of code gives you the <code>Hello World</code> solution,</p><script src='https://gist.github.com/1038740.js?file=Program.cs'></script><noscript><pre><code>using (var server = new HttpServer("http://localhost:1234/")){    server.GET("/").Subscribe(context =&gt;         context.Respond("Hello World"));    Console.ReadLine();}</code></pre></noscript><p>I added the <code>Console.ReadLine()</code> to stop the console app exiting and cleaning things up.  Running the app and going to <code>http://localhost:1234</code> gives you the result.  The <code>HttpServer</code> object has a number of methods for the various <span class="caps">HTTP</span> verbs and these methods all return instances of <code>IObservable</code> which means you can subscribe to them and apply all those filters, transforms etc. the Rx offers.</p><h2>Other Anna Features</h2><p>As I said <a href="https://github.com/jfromaniello/Anna/">Anna</a>  is still in the early stages so once you grab a route there isn&#8217;t a <span class="caps">MASSIVE</span> amount you can do with but respond.  Responses however are chainable so you can create an almost middleware like stack for requests e.g.</p><script src='https://gist.github.com/1038778.js?file=Anna.cs'></script><noscript><pre><code>var route = server.GET("/");route.Subscribe(context =&gt; context.Respond("Hello "));route.Subscribe(context =&gt; context.Respond("World"));</code></pre></noscript><p>This gives you the same output as the original Hello World sample.</p><p>But from what I can see thats about as far as you can get.  In <a href="http://nodejs.org/">node.js</a> there is a framework called <a href="http://senchalabs.github.com/connect/">Connect</a> now I&#8217;m not sure if <a href="https://github.com/jfromaniello/Anna/">Anna</a>  is intending to go in this sort of direction but I think it could be moulded into something like this with a bit of <span class="caps">TLC</span>.  The problem is at the minute I don&#8217;t see any sort of object passed along the subscription chain e.g. a <code>dynamic</code> bag or something. I don&#8217;t even know how to easily manage response headers.</p><h3>Routes and Route Fragments</h3><p><a href="https://github.com/jfromaniello/Anna/">Anna</a>  supports creating different routes including routes with dynamic sections <code>/name/{name}</code> that are used to populated a <code>UriFragments</code> property,</p><script src='https://gist.github.com/1038812.js?file=Fragments.cs'></script><noscript><pre><code>server.GET("/hello/{name}").Subscribe(context =&gt; context.Respond(    string.Format("Hello {0}", context.Request.UriArguments.name)));</code></pre></noscript><h3>Conditional Routes</h3><p>Thanks to the power of Rx and Linq it is possible to create conditional routes an create chains that have pre-response checks.  For example we can have a route that only triggers a response if the QueryString has a secret parameter.</p><script src='https://gist.github.com/1038831.js?file=Secret.cs'></script><noscript><pre><code>var route = server.GET("/");route.Subscribe(context =&gt; context.Respond("&lt;h1&gt;Hello World<p>&#8220;));<br>route.Where(ctx =&gt; ctx.Request.QueryString.secret == &#8220;letmein&#8221;)<br>     .Subscribe(ctx =&gt; ctx.Respond(&#8220;<h2>Secret Message</h2>&#8221;));</code></pre></noscript><p><p>So if you hit <code>http://localhost:1234/</code> you get Hello World.  Hit that again with the param <code>?/secret=letmein</code> and you get the super secret message.</p><h2>Conclusion</h2><p>Thats about it for now but I think I&#8217;ll be keeping an eye on this project and see were it goes.  Even though it&#8217;s still early days I like the concept behind the library and the fresh approach it&#8217;s taking.  I&#8217;ll push some of my sample code up to Github and update this post in the next few days.  In the meantime Jose the creator of Anna has <a href="http://joseoncode.com/2011/06/17/event-driven-http-server-in-c-with-rx-and-httplistener/">some nice examples</a> of Rx based HttpServer stuff on his blog featuring a long polling example.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/21/microorms-for-dotnet-inserts-updates-deletes/">MicroORMs for .NET: Inserts, Updates &amp; Delete</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-21T00:00:00+01:00" pubdate data-updated="true">Jun 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <blockquote class="announce">This post is the is part of series of posts covering the various microORMs in the .<span class="caps">NET</span> world.  I intend to look at how each microORM meets certain data access and manipulation needs.  The current series includes,<ul>	<li><a href="http://yobriefca.se/blog/2011/06/15/microorms-for-dotnet">Obligatory Introduction Post</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/16/microorms-for-dotnet-select-one">Syntax &#8211; SELECTs</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/18/microorms-for-dotnet-stored-procedures">Stored Procedures</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/21/microorms-for-dotnet-inserts-updates-deletes">Inserts, Updates &amp; Deletes</a><br></li></ul></blockquote><p>Moving swiftly on, if all our solutions only used different way to select data then how would we ever get data into our solution?  So lets look at how these microORMs handle Inserts, Updates and Deletes<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>.  These examples will follow on from previous ones so I am only going publish the key lines.  If you want the complete code you can grab them from the <a href="https://github.com/kouphax/microorm-comparison">GitHub project</a>.</p><h2>Dapper</h2><h3>Insert</h3><p>Nothing unexpected here.  More <span class="caps">SQL</span>.  Sam Saffron previously pointed me in the direction of <a href="http://code.google.com/p/dapper-dot-net/source/browse/Dapper.Contrib/Extensions/SqlMapperExtensions.cs">Dapper.Contrib</a> that has extra extension methods for doing things like <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> but at the time of trying I couldn&#8217;t get it to work and have an <a href="https://github.com/SamSaffron/dapper-dot-net/issues/8">open issue</a> on GitHub.  If I get an update on this I&#8217;ll post the slightly cleaner syntax.</p><p class="minimal-gist"><script src='https://gist.github.com/1036689.js?file=DapperInsert.cs'></script><noscript><pre><code>conn.Open();int count = conn.Execute(    "INSERT Authors(Username, FullName, CreatedDate) " +    "VALUES (@Username, @FullName, GETDATE())",    new { Username = "james@dapper.net", FullName = "James Hughes" });</code></pre></noscript></p><h3>Update</h3><p>Update is very similar to insert.  The nice thing about this approach vs. using POCOs is that you only need to send the delta of the object up where as with the other approaches you may have to fetch the object before updating.</p><p class="minimal-gist"><script src='https://gist.github.com/1037727.js?file=DapperUpdate.cs'></script><noscript><pre><code>int count = conn.Execute(    "UPDATE Authors SET FullName = @FullName WHERE Id = @Id",    new { FullName = "James Hughes", Id = 1 });</code></pre></noscript></p><h3>Delete</h3><p>Delete is pretty much what you&#8217;d expect.  I&#8217;ll update these examples when I get my problems with Dapper.Contrib sorted but when you are so close to the <span class="caps">SQL</span> metal there isn&#8217;t a massive amount to discuss.</p><p class="minimal-gist"><script src='https://gist.github.com/1037737.js?file=DapprDelete.cs'></script><noscript><pre><code>int count = conn.Execute(    "DELETE FROM Authors WHERE Id = @Id",    new { Id = 1 });</code></pre></noscript></p><h2>Massive</h2><h3>Insert</h3><p>Massive keeps things simple as usual.  <code>Insert</code> can take POCOs as well as dynamic object (and a number of other types) and it uses the info found in the <code>Authors</code> DynamicModel class to generate the <span class="caps">SQL</span> for you.</p><p class="minimal-gist"><script src='https://gist.github.com/1036724.js?file=MassiveInsert.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Insert(new {    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>As a bonus feature Massive can wrap multiple inserts in a single transaction and perform multiple inserts at once.</p><p class="minimal-gist"><script src='https://gist.github.com/1037434.js?file=MassiveInsertMany.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.InsertMany( new [] {    { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now },     { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now },     { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now } });</code></pre></noscript></p><h3>Update</h3><p>Like Dapper, Massive allows us to send only a delta between the old and new object.</p><p class="minimal-gist"><script src='https://gist.github.com/1037745.js?file=MassvieUpdate.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Update(new {    FullName = "James Hughes"}, 1);</code></pre></noscript></p><p>Massive also gets extra points for the <code>UpdateMany</code> that, not suprisingly, behaves like the <code>InsertMany</code> method mentioned above (except for updates of course).</p><h3>Delete</h3><p>Ultra simple approach to Deleting specific objects just pass in an id and you&#8217;re done,</p><p class="minimal-gist"><script src='https://gist.github.com/1037749.js?file=MassiveDelete.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Delete(2);</code></pre></noscript></p><h2>PetaPoco</h2><h3>Insert</h3><p>PetaPoco offers 2 main ways to insert your data<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup>.  You can pass in a plain <span class="caps">POCO</span> (or in our case on that uses attributes to normalise the difference between the schema and the C# class),</p><p class="minimal-gist"><script src='https://gist.github.com/1037467.js?file=PetaPocoInsert1.cs'></script><noscript><pre><code>PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString");var x = db.Insert(new Author{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Or you can pass in an anonymous object specifying the table and primary key field,</p><p class="minimal-gist"><script src='https://gist.github.com/1037469.js?file=PetaPocoInsert2.cs'></script><noscript><pre><code>var x = db.Insert("Authors", "Id", new{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><h3>Update</h3><p>There are plenty of ways to update data using PetaPoco.  The first one is to pass in your model object and the row will get updated.  I am creating a new object in this example but you could just fetch it from the database as you&#8217;d expect,</p><p class="minimal-gist"><script src='https://gist.github.com/1037781.js?file=PetaPocoUpdate1.cs'></script><noscript><pre><code>PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString");var x = db.Update(new Author{    Id = 9,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Another approach is to just pass up a delta of the changes,</p><p class="minimal-gist"><script src='https://gist.github.com/1037784.js?file=PetaPocoUpdate2.cs'></script><noscript><pre><code>var x = db.Update("Authors", "Id", new{    Id = 10,    FullName = "James Hughes"});</code></pre></noscript></p><p>Alternatively you can simply pass up the delta and specify the primary key value externally,</p><p class="minimal-gist"><script src='https://gist.github.com/1037789.js?file=PetaPocoUpdate3.cs'></script><noscript><pre><code>db.Update("Authors", "Id", new { FullName = "James Hughes" }, 12);</code></pre></noscript></p><p>Variety is the spice of life in PetaPoco!</p><h3>Delete</h3><p>Thanks to the custom attribute on our Author class deleting a record is a matter of passing the Id to the <code>Delete</code> method,</p><p class="minimal-gist"><script src='https://gist.github.com/1037792.js?file=PetaPocoDelete.cs'></script><noscript><pre><code>db.Delete&lt;Author&gt;(8);</code></pre></noscript></p><h2>ServiceStack ORMLite</h2><h3>Insert</h3><p>ORMLite is pretty much inline with the other microORMs a simple <code>Insert</code> method that accepts a <span class="caps">POCO</span> or an anonymous object and generates <span class="caps">SQL</span> based on the info given.  This can be done in one of two ways,</p><p class="minimal-gist"><script src='https://gist.github.com/1037549.js?file=ORMLiteInsert1.cs'></script><noscript><pre><code>using (IDbConnection db = Program.ConnectionString.OpenDbConnection())using (IDbCommand cmd = db.CreateCommand()){    cmd.Insert&lt;Author&gt;(new Author    {        Username = "james@dapper.net",        FullName = "James Hughes",        CreatedDate = DateTime.Now    });}</code></pre></noscript></p><p>Or the factory approach discussed in the first article,</p><p class="minimal-gist"><script src='https://gist.github.com/1037551.js?file=ORMLiteInsert2.cs'></script><noscript><pre><code>IDbConnectionFactory dbFactory = new OrmLiteConnectionFactory(    Program.ConnectionString,    SqlServerOrmLiteDialectProvider.Instance);<p><p>dbFactory.Exec(dbCmd =&gt; dbCmd.Insert<author>(new Author<br>{<br>    Username = &#8220;james@dapper.net&#8221;,<br>    FullName = &#8220;James Hughes&#8221;,<br>    CreatedDate = DateTime.Now<br>}));</author></code></pre></noscript></p><h3>Update</h3><p>ORMLite sticks with one approach for updating a row &#8211; passing in a <span class="caps">POCO</span> that it can map to a table/row,</p><p class="minimal-gist"><script src='https://gist.github.com/1037796.js?file=ORMLiteUpdate.cs'></script><noscript><pre><code>cmd.Update(new Author{    Id = 7,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>If you really don&#8217;t want to fetch your row again and only want to send up a delta you&#8217;ll have to roll your own approach (simple enough though).</p><h3>Delete</h3><p>ORMLite supports a number of neat ways to delete rows,</p><ul>	<li><code>DeleteById(id)</code></li>	<li><code>Delete(where_clause, id)</code></li>	<li><code>Delete(object)</code></li></ul><p class="minimal-gist"><script src='https://gist.github.com/1037807.js?file=ORMLiteDelete.cs'></script><noscript><pre><code>cmd.DeleteById&lt;Author&gt;(5);cmd.Delete&lt;Author&gt;("Id = @0", 6);cmd.Delete(new Author { Id = 7 });</code></pre></noscript></p><h2>Simple.Data</h2><h3>Insert</h3><p>Guess what Simple.Data&#8217;s approach is once again very fluent, clean and easy to understand.  OK I don&#8217;t get Intellisense as the methods are dynamic but I didn&#8217;t need it anyway.</p><p class="minimal-gist"><script src='https://gist.github.com/1037553.js?file=SimpleDataInsert.cs'></script><noscript><pre><code>Author x =  Simple.Data.Database.Open().Author.Insert(new Author{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><h3>Update</h3><p>Simple.Data has 2 ways of updating.  <code>Update</code> takes a <span class="caps">POCO</span> and maps the id to the specific row,</p><p class="minimal-gist"><script src='https://gist.github.com/1037803.js?file=SimpleDataUpdate1.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.Update(new Author{    Id = 5,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Alternatively Simple.Data supports the delta approach too using <code>UpdateById</code></p><p class="minimal-gist"><script src='https://gist.github.com/1037804.js?file=SimpleDataUpdate2.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.UpdateById(    Id: 6,     FullName: "James Hughes");</code></pre></noscript></p><h3>Delete</h3><p>Finally Simple.Data has 2 ways to delete a record,</p><ul>	<li><code>DeleteById(id)</code></li>	<li><code>Delete(named_parameters)</code></li></ul><p class="minimal-gist"><script src='https://gist.github.com/1037813.js?file=SimpleDataDelete.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.DeleteById(3);Simple.Data.Database.Open().Authors.Delete(Id: 4);</code></pre></noscript></p><h2>There We Have It</h2><p>OK OK I guess this post feels a bit rushed.  I started out throwing lots of details into selects and stuff but this one just isn&#8217;t up to par.  I slowly discovered that I&#8217;d have to spend almost all my spare time covering all the aspects I wanted.  So I cut it back to a kind of &#8220;Starter for 10&#8221; approach.  Yeah thats right I&#8217;m leaving stuff up to you to ask and research :-P.  Anyway in these basic examples no one <span class="caps">ORM</span> really stands out too much.  Simple.Data is, as always, lovely and clean and PetaPoco offers a very flexible experience.  I like the ability to send deltas instead of full objects back (in case you hadn&#8217;t guessed) and I had a few annoyances around updates using Massive and Dapper but I think it was my own stupidity (I&#8217;ll update when I investigate).  If I had to choose between them I am still tending towards Simple.Data and PetaPoco (probably PetaPoco at this stage) but I do find all of them a much more pleasant experience vs. MyIbatis or NHibernate.</p><p>That should be enough to start anyone off on the right foot.</p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Hehehehe IUDs</p><p class="footnote" id="fn2"><a href="#fnr2"><sup>2</sup></a> You can pass a <span class="caps">SQL</span> string or a <span class="caps">SQL</span> builder as well but it&#8217;s fairly straightforward so I&#8217;ll not cover it here.  See the original <a href="http://yobriefca.se/blog/2011/06/16/microorms-for-dotnet-select-one"><span class="caps">SELECT</span> post</a> for a <span class="caps">SQL</span> and <span class="caps">SQL</span> Builder example.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/20/baler-0.4-released/">Baler v0.4 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-20T00:00:00+01:00" pubdate data-updated="true">Jun 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <p>Just a quick note to say that Baler v0.4 has been released.  Nothing new here I have simply compiled it (and the official extensions) against .NET3.5 just to make it more useable for people still stuck on old projects :-P</p><p>Everything is on Nuget already so go have fun.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/19/thinking-about-hackathons/">Thinking About Hackathons</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-19T00:00:00+01:00" pubdate data-updated="true">Jun 19<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <div class="update"><p>This post is a bit of a brain dump so expect some incoherence and repetition.  I&#8217;m buzzed on coffee and feel like a kid in a toy shop so I just want to get it out there and if anyone has any experience of hackathons feel free to pitch in.  In fact please do :)</p><p>Also sorry for the blogging overload.</p></div><h2>Background</h2><p>So I recently started walking to and from work.  The walk is about 3.5 miles which takes about 50 minutes.  This gives me a lot of time to think, even over think but even I bore myself sometimes so I decided to give podcasts a try.  I grabbed a load of <a href="http://hanselminutes.com">Hanselminutes</a> and <a href="http://herdingcode.com/">Herding Code</a> episodes to maybe learn something new.  One of the <a href="http://herdingcode.com/">Herding Code</a> podcasts really caught my attention &#8211; <a href="http://herdingcode.com/?p=310">109: Harmony Hackathon</a>.  The podcast tells the story of a group of people that got together and spent 48 hours designing and developing a solution for a charity organisation.  I&#8217;ve heard of hackathons before but hearing these guys talk about their experiences while using a technology stack that is my bread and butter (.<span class="caps">NET</span>) just got me all tingly inside.</p><p>I wanted to do this.  I know it sounds pathetic but the experience of hashing something out, cutting code and working totally agile without the bureaucracy of management slowing things up<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> sounds really fun to me.  I tend to get bored on long running projects.  I really want to try new things in real projects but convincing managers or customers is a near impossible task as the &#8220;play it safe&#8221; attitude makes a lot more sense to them.  Come on guys who cares about money when there is fun to be had?</p><p>So anyway this got me thinking.  How would I go about this, why would I go about this and how would I get other people to give 24 or 48 straight hours of their life for something like this?  I mean I live in Belfast, Northern Ireland not exactly a <span class="caps">MAJOR</span> hub of geek activity.</p><h2>Hackathon Goals</h2><p>So why would we do this?  Having clear goals upfront is really going help sell this to people.  They will also act as guidance and help drive the entire event to the finish line.  There are plenty of reasons, perhaps even contradictory ones,</p><ul>	<li>A finished product or prototype</li>	<li>Education of technologies and techniques</li>	<li>The experience</li>	<li>Technology evaluation</li>	<li>Networking</li>	<li>Something to put on your CV</li></ul><p>I realise that much of this is done on a per person basis but unless each persons goals are aligned in some way there is a risk the whole thing would fall apart.  Personally I think people wanting to leverage it for any sort of networking, CV building or taking unfounded punts on technology need not apply.  I am not adverse to a bit of risk taking in the technology stakes but they need to be calculated risks rather than a <em>&#8220;ohhh shiny lets use this&#8221;</em> attitude.  If it&#8217;s putting all the other goals at risk it&#8217;s not worth it.</p><ul>	<li>A finished product or prototype</li>	<li>Education of technologies and techniques</li>	<li>The experience</li>	<li><del>Technology evaluation</del></li>	<li><del>Networking</del></li>	<li><del>Something to put on your CV</del></li></ul><p>I&#8217;d be happy working with people who agree with me on at least 2 of the points above.  But of course this isn&#8217;t a hard and fast rule and I remain open for the greater good.</p><h2>The Idea</h2><p>So what would we do?  I don&#8217;t think it would work very well if we just played around with some technologies and produced a few prototypes.  No, addressing a real work problem or need that is of sufficient size and complexity that allows us to drive a spike right through the entire solution gives us something to work towards.  Actually producing something that works or at least proves that the idea is viable seems almost mandatory.  The thought of walking away after the 24 or 48 hours with something that you can show people is a noble goal.  Whether that be for charity, something internal for your company or something for the open source community.</p><p>I have plenty of ideas I would go for but this isn&#8217;t a dictatorship (not at this point anyway) this is only going to work if people feel really involved, after all when the &#8220;mid way slump&#8221; starts kicking in you&#8217;re only going to make it through if you <span class="caps">WANT</span> it to work and are invested in experience.  I guess what I am saying is you&#8217;d get people together &#8211; potential developers, product owners, investors up front and brainstorm, plan and argue.  This brings me on to another point&#8230;.</p><h2>The 7 P&#8217;s</h2><p>Prior Preparation and Planning Prevent Piss Poor Performance.  The more I think about this hackathon thing the more I come to the conclusion that it is so much bigger than the 24 or 48 hours of design and development.  Like all good adventures you have to go in prepared.  What would you need upfront?</p><ul>	<li>You need your goals clearly defined</li>	<li>You need a few user stories so there is something for people to do while things are getting established</li>	<li>You need your stack and approach mapped out (including source control, <acronym title="Continuous Integration"><span class="caps">CI</span></acronym> and Build Server etc.)</li>	<li>The participants need to at least have a fair idea what they are doing</li>	<li>You need to have some sort of rough plan or schedule</li>	<li>You need food, drink, beer, alternative entertainment</li>	<li>You need a venue, a comfortable venue with internet access</li>	<li>Oh and I guess you need to invest in whiteboards.  Lots and lots of whiteboards, and markers, and cue cards and possibly deodorant.</li></ul><h2>People involved</h2><p>Agile makes sense here, of course it does.  So it&#8217;s not just a matter of locking a few devs away with coffee and vitamin pills.  No you need product owners at hand, you need someone testing and you need some sort of <span class="caps">BDFL</span> (Benevolent Dictator for Life).  I guess a <span class="caps">BDFL</span> isn&#8217;t mandatory but a technical lead who has the final say is certainly going to make the decision making process a lot quicker &#8211; be that good or bad.</p><p>Motivational people are another thing that would come in handy.  Having people see something and be like &#8220;yeah that&#8217;s nice, good job&#8221; is going to keep those flagging energy levels up.</p><p>Developer headcount is another balancing act.  You need enough people to make the goals achievable but you also can&#8217;t have too many people or you risk stamping on each others feet.  I guess it depends on the size/complexity of the idea you want to implement but a finger in the air guess I&#8217;d say between 4-8 developers with a product owner and a tester (could be the same person) would be a nice number.</p><h2>Development Approach</h2><p>I&#8217;ve already said agile seems like a perfect fit and I think the whole ecosystem that agile brings in fits well.  <acronym title="Test Driven Development"><span class="caps">TDD</span></acronym>/<acronym title="Behaviour Driven Design"><span class="caps">BDD</span></acronym> almost seems mandatory here &#8211; at least some level of it.  Checking in code with no tests around it is going to cause a headache when you hit a bug that takes and hour to track down.  A strict regime of constant branching, merging and checkins (every 20 minutes or less) along with a fast continuous build system will help discover problems <span class="caps">ASAP</span>.</p><h2>Atmosphere and Communication</h2><p>An entire project condensed into 24/48 hours is going to magnify the pain points and tensions will rise.  Techniques such as Pomodoro would come in handy to make sure people aren&#8217;t burning themselves out too fast.  A quiet room and alternative non-computer based entertainment will give people a quick escape on their pomodoro break and a chance to get their head showered.  Communication <span class="caps">NEEDS</span> to flow so regular standups (every 30 minutes to an hour) are essential to spot problems early and find a way to resolve them quickly.  Again having some sort <acronym title="Benevolent Dictator for Life"><span class="caps">BDFL</span></acronym> could really help in this situation.</p><h2>Where now?</h2><p>You know what &#8211; someway, somehow I am going to do this.  Consider it part of my career bucket list.  Something I want to do before I join the great geek scrapheap in the sky.  Could I get the people? Yeah I reckon I could.  Could I get the sponsorship/support?  Most likely.  Could I find a suitable idea to run with?  Hells yeah.  So what is stopping me?  Hmmmmmm nothing.  <span class="caps">BRB</span> got a hackathon to organise&#8230;&#8230;..<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup></p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Not all managers are created equal but they have a job to do and process, meetings, documents etc. all get in the way.</p><p class="footnote" id="fn2"><a href="#fnr2"><sup>2</sup></a> Yeah really.  No joke.  I can but try.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/18/microorms-for-dotnet-stored-procedures/">MicroORMs for .NET: Stored Procedures</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-18T00:00:00+01:00" pubdate data-updated="true">Jun 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <blockquote class="announce">This post is the is part of series of posts covering the various microORMs in the .<span class="caps">NET</span> world.  I intend to look at how each microORM meets certain data access and manipulation needs.  The current series includes,<ul>	<li><a href="http://yobriefca.se/blog/2011/06/15/microorms-for-dotnet">Obligatory Introduction Post</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/16/microorms-for-dotnet-select-one">Syntax &#8211; SELECTs</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/18/microorms-for-dotnet-stored-procedures">Stored Procedures</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/21/microorms-for-dotnet-inserts-updates-deletes">Inserts, Updates &amp; Deletes</a><br></li></ul></blockquote><p>As handy as running straight, fully-tailored SELECTs straight from your app code a lot of the time, especially in the &#8220;enterprise&#8221; world your <span class="caps">DBA</span> is going to insist that all operations go through tightly controlled stored procedures.  It&#8217;s all for the greater good I&#8217;m sure but flipsake it&#8217;s bloody annoying.</p><div style='font-family:"Courier New", Courier;color:#0b0;background-color:black; padding:1px 20px;font-size:0.9em;margin-left:20px;margin-right:20px;'><p><em>You are standing at the edge of a forest.  Ahead of you an old wooden sign sits at a slight angle.</em></p><p><strong>&gt;&gt; read sign</strong></p><p><em>You squint your eyes as you approach the sign and read the fading writing.  The sign reads</em></p><p style="padding-left:1em;"><em>&#8220;Welcome to the forest of microORMs.  You have nice eyes.  Have a <span class="caps">GREAT</span> day.&#8221;</em></p><p><strong>&gt;&gt; enter forest</strong></p><p><em>You walk, nay skip, into the forest.  A few minutes in you are confronted with a horribly gnarled beast.  The grumpy looking thing seems very out of place in this land of near tranquilty.  As you approach, it speaks</em></p><p style="padding-left:1em;"><em>&#8220;<span class="caps">GROAN</span> <span class="caps">GRUNT</span> Control <span class="caps">GROWL</span> Best Practise <span class="caps">WHEEZE</span> Enterprise Ready <span class="caps">SNARL</span>.  Little being&#8230; you may not pass any way you please.  That is not how we do things <span class="caps">GRUMBLE</span> <span class="caps">WHEEZE</span>. No to pass this way meatbag you must, yes must, take this route I have planned for you.  If you need to change your route I must approve it and construct it <span class="caps">COUGH</span> <span class="caps">GRUMBLE</span>.  There is limited scenery and not too many points to have fun&#8221;</em></p><p><strong>&gt;&gt; kill beast</strong></p><p><em>I&#8217;m afraid I can&#8217;t do that</em></p><p><strong>&gt;&gt; fffffffffffffffffffff..</strong></p></div><p>Fear not help is at hand.  So can we call sprocs using our microORMs, and if yes how?  Lets go see shall we?<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p><h2>Dapper</h2><p>Dapper makes use of an extra parameter in its <code>Query&lt;T&gt;</code> method to specify a specific command type.  In this way it&#8217;s simply a matter of passing in the name of the sproc, the parameters and a <code>CommandType.StoredProcedure</code> as a named parameter.</p><p class="minimal-gist"><script src='https://gist.github.com/1032323.js?file=Dapper.cs'></script><noscript><pre><code>Author author = conn.Query&lt;Author&gt;(    "GetAuthorById",    new { Id = 1 },    commandType: CommandType.StoredProcedure).First();</code></pre></noscript></p><p>And boom thats it.  Same applies for multiple results.</p><h2>Massive</h2><p>Massive just works.</p><p class="minimal-gist"><script src='https://gist.github.com/1032340.js?file=Massive.cs'></script><noscript><pre><code>dynamic dyn = tbl.Query("GetAuthorById @0", 1).First();</code></pre></noscript></p><p>All I did was swap out the <span class="caps">SELECT</span> statement for the name of the sproc and Bobs Your Uncle.  Nice.</p><h2>PetaPoco</h2><p>PetaPoco has <em>some</em> support for sprocs.  For my needs in this article it works fine but apparently it doesn&#8217;t support output parameters <span class="caps">ATM</span>.  You need to prepend your call to the sproc with a DB specific command.</p><p class="minimal-gist"><script src='https://gist.github.com/1032349.js?file=PetaPoco.cs'></script><noscript><pre><code>Author a = db.Query&lt;Author&gt;("EXECUTE GetAuthorById @0", 1).First();</code></pre></noscript></p><p>The <code>EXECUTE</code> statement is database specific.  If you are using MySql you need to use <code>CALL</code> instead which kind of starts breaking the abstraction a bit.  I wonder if we will see this support getting more solidified in future releases.</p><h2>ServiceStack ORMLite</h2><p>At the time of writing this I couldn&#8217;t see any built in support for sprocs using ORMLite.  Either I am being my typical clueless self or we would just have to do it by hand.  Here is what I came up with,</p><p class="minimal-gist"><script src='https://gist.github.com/1032433.js?file=ORMLite.cs'></script><noscript><pre><code>Author author = dbFactory.Exec(dbCmd =&gt; {    dbCmd.CommandType = CommandType.StoredProcedure;    dbCmd.Parameters.Add(new SqlParameter("@id", 1));    dbCmd.CommandText = "GetAuthorById";    return dbCmd.ExecuteReader().ConvertTo&lt;Author&gt;();});</code></pre></noscript></p><p>It&#8217;s not exactly the worst thing in the world and I guess you could wrap this stuff in an extension method but still I feel spoilt by the other microORMs so far and this was a slight disappointment.  Perhaps someone could either confirm or deny sproc support in ORMLite?</p><h2>Simple.Data</h2><p>Simple.Data has lovely syntax for this.  You just call it as yet another dynamic method on the database object and Simple.Data just infers it for you.</p><p class="minimal-gist"><script src='https://gist.github.com/1032360.js?file=SimpleData.cs'></script><noscript><pre><code>Author author = Simple.Data.Database.Open().GetAuthorById(1).First();</code></pre></noscript></p><p>Yeah thats nice.</p><h2>Slightly Shorter and Summing Up</h2><p>So I didn&#8217;t want this one to have too much waffle (bar the odd text adventure here and there).  I was concerned that perhaps calling sprocs might be one of those requirements were the whole microORM stuff starts falling apart but no.  They actually handle the whole thing in a nice, clean manner.</p><p>Simple.Data is certainly starting to look more appealing to me and the whole fact that it&#8217;s not database specific (you&#8217;ve got NoSQL stores and even experimental things such as a Registry adapter &#8211; imagine this as part of Powershell).</p><p>Anyway some code snippets for this stuff are currently available in the <a href="https://github.com/kouphax/microorm-comparison">project/series github repo</a></p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Not a real game.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/17/baler-v0.3-released/">Baler v0.3 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-17T00:00:00+01:00" pubdate data-updated="true">Jun 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <p>I&#8217;ve just pushed a new version of <a href="http://yobriefca.se/projects/baler">Baler</a>.  It&#8217;s current version of 0.3 but semantically speaking it should be v0.2.2 as I haven&#8217;t changed the <span class="caps">API</span>.  But hey we all make mistakes :(</p><h2>What&#8217;s New?</h2><p>Thanks to a suggestion from <a href="https://github.com/edazdarevic">edazdarevic</a> this release reworks the way files are generated.</p><p>Originally if a bale wasn&#8217;t flagged as generated (e.g. after an <span class="caps">IIS</span> reset) a new file with a random name would be generated.  This mean&#8217;t that during development a shed load of files would be generated as you changed some other file and restarted your server.  This lead to an awful mess in your output folder.  Now what happens if a bale isn&#8217;t flagged as generated the contents of the file are processed and a hash is generated from this.  This hash is then used as the filename for that file (appended with the correct extension).  If that file exists then the contents haven&#8217;t changed and are not written out to a new file saving that extra file system write.</p><p>In the future I&#8217;d like to adopt the approach of simply writing out references to the bales contents during <code>DEBUG</code>/development mode and only process the bales when in <code>PRODUCTION</code> mode.  But for now I think this is a reasonable stop gap.</p><p><a href="https://github.com/edazdarevic">edazdarevic</a> has some <a href="https://github.com/kouphax/baler/issues/1">more ideas</a> that I plan on trying to integrate but I need more time to think about how to approach it without bloating the code.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/16/microorms-for-dotnet-select-one/">MicroORMs for .NET: Syntax - SELECTs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-16T00:00:00+01:00" pubdate data-updated="true">Jun 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <blockquote class="announce">This post is the is part of series of posts covering the various microORMs in the .<span class="caps">NET</span> world.  I intend to look at how each microORM meets certain data access and manipulation needs.  The current series includes,<ul>	<li><a href="http://yobriefca.se/blog/2011/06/15/microorms-for-dotnet">Obligatory Introduction Post</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/16/microorms-for-dotnet-select-one">Syntax &#8211; SELECTs</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/18/microorms-for-dotnet-stored-procedures">Stored Procedures</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/21/microorms-for-dotnet-inserts-updates-deletes">Inserts, Updates &amp; Deletes</a><br></li></ul></blockquote><p>The two main things I want to look at in this article are</p><ol>	<li>Syntax of the microORM, specifically around,</li>	<li>Selecting single and multiple results</li></ol><p>So the most obvious starting point, bar the <a href="../15/microorms-for-dotnet/">boring introduction</a>, is how you perform selects using these awesome thingies.  To begin with lets get our playground set up.  Lets create a table of authors, lets call it <code>Authors</code><sup class="footnote" id="fnr0"><a href="#fn0">0</a></sup></p><script src='https://gist.github.com/1028123.js?file=createauthors.sql'></script><noscript><pre><code>CREATE TABLE Authors(  Id          int          IDENTITY(1,1) NOT NULL,  Username    varchar(50)                NOT NULL,  FullName    varchar(250)               NOT NULL,  CreatedDate datetime                   NOT NULL, CONSTRAINT PK_Authors PRIMARY KEY CLUSTERED (Id ASC))</code></pre></noscript><p>And populate it with some (meaningless) data<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>,</p><script src='https://gist.github.com/1028134.js?file=insertauthors.sql'></script><noscript><pre><code>INSERT INTO Authors(Username, FullName, CreatedDate) VALUES ('0@example.com', 'James Red', GETDATE());INSERT INTO Authors(Username, FullName, CreatedDate) VALUES ('1@example.com', 'Harry Black', GETDATE());-- ...CROPPED FOR BREVITY...INSERT INTO Authors(Username, FullName, CreatedDate) VALUES ('134@example.com', 'Chloe Green', GETDATE());</code></pre></noscript><p>Finally we need to create the equivalent C# object that our results can map to.  Again nothing too crazy here,</p><script src='https://gist.github.com/1028148.js?file=Author.cs'></script><noscript><pre><code>public class Author{    public int Id { get; set; }    public string Username { get; set; }    public string FullName { get; set; }    public DateTime CreatedDate { get; set; }}</code></pre></noscript><p>So now the stage is set and it&#8217;s time for our microORMs to play their part.</p><h2>Selecting Single and Multiple Authors</h2><p>So lets assume we want to do 2 things -</p><ul>	<li>Select a single author with an Id of 1, and,</li>	<li>Select multiple authors whose username (in this case the users email address) ends with <em>example.com</em>.</li></ul><h3>Dapper</h3><p>Dapper has a single way of querying your database and it offers this via an extension method on the standard <code>SqlConnection</code> class,</p><script src='https://gist.github.com/1028156.js?file=DapperSelect.cs'></script><noscript><pre><code>using (SqlConnection conn = new SqlConnection(ConnectionString)){    conn.Open();    Author a = conn.Query&lt;Author&gt;(        "SELECT * FROM Authors WHERE Id = @Id",         new { Id = 1 }).First();}</code></pre></noscript><p>As you can see I&#8217;ve just opened a normal connection using a ConnectionString property I pulled from my <code>App.config</code>&#8217;s ConnectionString config block.  The magic here lies in the <code>Query&lt;Author&gt;</code> method.  This method accepts a parameterised <span class="caps">SQL</span> string and maps the result back into the object you specified.  Ultra simple, ultra clean.  There are a whole host of other arguments to the <code>Query&lt;T&gt;</code> method but it would fill this post up pretty fast.</p><p>Selecting multiple object simply requires me to change the query to meet the new requirements,</p><script src='https://gist.github.com/1028838.js?file=DapperSelectMany.cs'></script><noscript><pre><code>IEnumerable&lt;Author&gt; dapperA = conn.Query&lt;Author&gt;(    "SELECT * FROM Authors WHERE Username LIKE @PartialUsername",    new { PartialUsername = "%example.com" });</code></pre></noscript><p>One of the features I really liked apart from the simplicity of the whole thing was the parameterised <span class="caps">SQL</span>.  Many of the frameworks support this but most support it by index based assignment e.g. &#8220;<span class="caps">WHERE</span> Id=@0&#8221;.  Thats fine but Dappers use of an anonymous object makes the whole thing that little bit nicer. No need to refactor strings should your arguments move around (it has happened) and it all reads just that tiny bit better as well.</p><p>Dapper also offers a non-generic <code>Query</code> method that returns instances of <code>dynamic</code> objects but I&#8217;m still to be convinced that this is useful when pushing these models into and back out of views etc.  Still it&#8217;s nice to have for those times that creating another model would be overkill.</p><h3>Massive</h3><p>Massive is slightly different to the other microORMs in that it only deals with <code>dynamic</code> objects from queries.  This means if you need concrete models you will have to map them either manually or use a tool to help (such as <a href="http://automapper.codeplex.com/">AutoMapper</a>).  Due to my schema (pluarl table names) I use Massive in a slightly different way to most people.  Massive requires your models to extend <code>Massive.DynamicModel</code> so to keep things clean I tended to naturally create a model that represents my Authors table,</p><script src='https://gist.github.com/1028975.js?file=MassiveAuthors.cs'></script><noscript><pre><code>public class Authors : Massive.DynamicModel{    public Authors()        : base("DefaultConnectionString")    {        PrimaryKeyField = "Id";    }}</code></pre></noscript><p>This provides an entry point for configuring how Massive connects to your database.  The <code>DynamicModel</code> has a constructor that allows us to specify a connection string name that Massive will lookup from the <code>Web/App.config</code> <code>ConnectionStrings</code> config section.  Alternatively if you don&#8217;t supply this Massive will grab the first one it finds.  This class also allows us to specify the table name (in this case inferred from the class name) and properties such as the primary key of the table (as shown above).</p><p>Now we have our class defined we can start selecting from the database.  To select a single object we can use the <code>Single</code> method.</p><script src='https://gist.github.com/1029000.js?file=MassiveSelectOne.cs'></script><noscript><pre><code>Authors table = new Authors();dynamic result = table.Single(1);Author author = Authors.Map(result);</code></pre></noscript><p>You&#8217;ll notice I&#8217;ve made another step here and that is mapping the <code>dynamic</code> result to a concrete <code>Author</code> object.  It&#8217;s a simple mapping method added to the <code>Authors</code> object but could be made more generic fairly easiy,</p><script src='https://gist.github.com/1029005.js?file=MassiveAuthorMap.cs'></script><noscript><pre><code>public static Author Map(dynamic obj){    return new Author    {        Id = obj.Id,        CreatedDate = obj.CreatedDate,        FullName = obj.FullName,        Username = obj.Username    };}</code></pre></noscript><p>Selecting multiple objects can be done in 2 ways using <code>All</code> which returns the entire table and then you filter or using the <code>Query</code> method (preferred unless you really want to return the entire table for refdata or something I guess)</p><script src='https://gist.github.com/1029015.js?file=MassiveSelectMany.cs'></script><noscript><pre><code>var tbl = new Authors();IList&lt;dynamic&gt; dyn = tbl.Query(    "SELECT * FROM Authors WHERE Username LIKE @0",     "%example.com");</code></pre></noscript><div class="update"><p><strong><span class="caps">UPDATE</span>:</strong> Rob, the creator of Massive, has just pushed <a href="http://wekeroad.com/post/6618062904/changed-my-mind-massive-changed-to-embrace-c">a new type of query syntax</a> into Massive.  The new approach makes use of named parameters</p><script src='https://gist.github.com/1031800.js?file=MassiveExample.cs'></script><noscript><pre><code>dynamic db = new Products();var products = db.FindBy(    CategoryID:8,    UnitPrice:100);</code></pre></noscript><p>I haven&#8217;t rewritten my stuff in this post but I want to close this post off and move on.  There is plenty more info in the <a href="http://wekeroad.com/post/6618062904/changed-my-mind-massive-changed-to-embrace-c">original post</a></p></div><h3>PetaPoco</h3><p>PetaPoco has a number of way of selecting single objects, or more specifically multiple ways of building/manipulating <span class="caps">SQL</span> queries.  But before we do that we need to get access to the database.  We do this via the <code>PetaPoco.Database</code> object which is an <code>IDisposable</code> wrapper around a Database connection that gives us the PetaPoco magic.</p><script src='https://gist.github.com/1029030.js?file=PetaPocoDatabase.cs'></script><noscript><pre><code>using (PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString")){    // query goes here}</code></pre></noscript><div class="update"><p><strong><span class="caps">UPDATE</span>:</strong> <a href="http://twitter.com/toptensoftware">Brad Robinson</a> has informed me that the <code>using</code> statement is unnecessary</p><blockquote><p>You don&#8217;t need to explicitly dispose the database object unless you&#8217;ve called OpenSharedConnection yourself. The idea is that if you&#8217;re using an <span class="caps">IOC</span> container to instantiate per-http-context instances you can call OpenSharedConnection at the start of the request and a single connection will be used for the entire http request. In practice I&#8217;ve found this not really necessary as most providers do connection pooling anyway. In other words, generally the using clause is not necessary.</p></blockquote></div><p>The Database constructor takes a name of a defined connection string to use for connecting to the database.  Now we are ready to start writing our query,</p><p><strong>Using Single(id)</strong></p><script src='https://gist.github.com/1029032.js?file=PetaPocoSelect.cs'></script><noscript><pre><code>Author a = db.Single&lt;Author&gt;(1);</code></pre></noscript><p><strong>Using Custom Parameterised <span class="caps">SQL</span></strong></p><script src='https://gist.github.com/1029033.js?file=PetaPocoSelect.cs'></script><noscript><pre><code>Author b = db.Single&lt;Author&gt;("SELECT * FROM Authors WHERE Id = @0", 1);</code></pre></noscript><div class="update"><p><strong><span class="caps">UPDATE</span>:</strong> <a href="http://twitter.com/toptensoftware">Brad Robinson</a> pointed out that it is also possible to used named parameters as discussed in the Dapper section above <code>@MyNamedParam</code> instead of <code>@0</code>.  The niceness just keeps coming with PetaPoco</p></div><p><strong>Using <span class="caps">SQL</span> Builder to Append Statements</strong></p><script src='https://gist.github.com/1029034.js?file=PetaPocoSelect.cs'></script><noscript><pre><code>Author c = db.Single&lt;Author&gt;(    PetaPoco.Sql.Builder        .Append("SELECT * FROM Authors")        .Append("WHERE Id = @0", 1));</code></pre></noscript><p><strong>Using <span class="caps">SQL</span> Builders Fluent Syntax to Append Statements</strong></p><script src='https://gist.github.com/1029036.js?file=PetaPocoSelect.cs'></script><noscript><pre><code>Author d = db.Single&lt;Author&gt;(    PetaPoco.Sql.Builder        .Select("*")        .From("Authors")        .Where("Id = @0", 1));</code></pre></noscript><p>See what I mean?  Lots of ways.  Now I guess the 3rd and 4th methods will probably seem a bit <acronym title="Over The Top"><span class="caps">OTT</span></acronym> for this simple select but think how powerful these would be if we had to conditionally build up our where clause or select statement based on a number of user defined conditions.  Nice.</p><p>Selecting multiple objects offers the same sort of variety except we can use either <code>Query</code> or <code>Fetch</code>.  The difference between the two is summed up by the PetaPoco site,</p><blockquote><p>These are pretty much identical except <code>Fetch</code> returns a List&lt;&gt; of POCO&#8217;s whereas <code>Query</code> uses <code>yield return</code> to iterate over the results without loading the whole set into memory.</p></blockquote><p>So what I say about <code>Query</code> applies to <code>Fetch</code> as well.  Retrieving multiple objects is done in the same way as selecting a single object in that you can give the method parameterised <span class="caps">SQL</span> or use the <span class="caps">SQL</span> builder to construct the query.</p><script src='https://gist.github.com/1029078.js?file=PetaPocoSelectMany.cs'></script><noscript><pre><code>IEnumerable&lt;Author&gt; authors = db.Query&lt;Author&gt;(    "SELECT * FROM Authors WHERE Username LIKE @0",     "%example.com");</code></pre></noscript><p>So to cover this off a full select using PetaPoco will would look like this.</p><script src='https://gist.github.com/1029081.js?file=PetaPocoSelectFull.cs'></script><noscript><pre><code>using (PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString")){    Author q = db.Single&lt;Author&gt;("SELECT * FROM Authors WHERE Id = @0", 1);}</code></pre></noscript><p><span class="caps">IMO</span> The syntax is nice, clean and flexible.  One thing about PetaPoco that is a <span class="caps">VERY</span> minor pain point for me is that it assumes singular name for tables which contradicted my earlier decision.  Not to worry PetaPoco uses attributes against the model class to manipulate the standard configuration and I can specify a class level attribute of <code>[PetaPoco.TableName("Authors")]</code> to put things right with the world.  This also only applies to the queries that use object inference such as <code>Single&lt;T&gt;</code> and not to the methods that accept <span class="caps">SQL</span>.</p><h3>ServiceStack ORMLite</h3><p>ORMLite from ServiceStack does things a wee bit differently to the rest.  It&#8217;s a bit less self-contained because it also applies extension methods to the string object as well.  Also like PetaPoco it takes the singular naming convention for Object Name &rarr; Table Name so first things first we need to annotate our <code>Author</code> model with another attribtue</p><script src='https://gist.github.com/1029204.js?file=ServiceStackAtribute.cs'></script><noscript><pre><code>[ServiceStack.DataAnnotations.Alias("Authors")]</code></pre></noscript><p>Another thing we need to do once before hand is set the dialect the ORMLite will use.  This is so it knows how to speak to the specific database type we created.  Typically you would put this in something like <code>Global.asax.cs</code>, <code>Program.cs</code> or whatever bootstrapper you care to use as it needs done only once.</p><script src='https://gist.github.com/1029116.js?file=Dialect.cs'></script><noscript><pre><code>OrmLiteConfig.DialectProvider = new SqlServerOrmLiteDialectProvider();</code></pre></noscript><p>Now we can go ahead and start selecting things like a boss,</p><script src='https://gist.github.com/1029120.js?file=ORMLiteSelectSingle.cs'></script><noscript><pre><code>using (IDbConnection db = "...".OpenDbConnection())using (IDbCommand cmd = db.CreateCommand()){    Author rows = cmd.GetById&lt;Author&gt;(1);}</code></pre></noscript><p>And for selecting many</p><script src='https://gist.github.com/1029129.js?file=ORMLiteSelectMany.cs'></script><noscript><pre><code>using (IDbConnection db = Program.ConnectionString.OpenDbConnection())using (IDbCommand cmd = db.CreateCommand()){    List&lt;Author&gt; rows = cmd.Select&lt;Author&gt;(        "Username LIKE {0}",         "%example.com");}</code></pre></noscript><p>Alternatively if we want to perform a specific operation on each result we can use the <code>Each&lt;T&gt;</code> to iterate over the result set rather than simply return it.</p><p>As you can see you don&#8217;t need to specify a full <span class="caps">SQL</span> query, just the <span class="caps">WHERE</span> clause which makes everything look a little bit neater and avoids repeating unnecessary portions of <span class="caps">SQL</span> that could be inferred.</p><p>ORMLite&#8217;s syntax is <em>slighlty</em> more complex &#8211; it feels a bit closer to the metal.  But it&#8217;s certainly not horribly different that it would put me off using it.</p><div class="update"><p><strong><span class="caps">UPDATE</span>:</strong> It seems there is another way to query the database that makes things a bit shorter.  Thanks to mythz (in the comments) for this one.</p><script src='https://gist.github.com/1030717.js?file=Alternative.cs'></script><noscript><pre><code>IDbConnectionFactory dbFactory = new OrmLiteConnectionFactory("...", 	SqlServerOrmLiteDialectProvider.Instance);Author author = dbFactory.Exec(dbCmd =&gt; dbCmd.GetById&lt;Author&gt;(1));List&lt;Author&gt; rows = dbFactory.Exec(dbCmd =&gt; 	dbCmd.Select&lt;Author&gt;("Username LIKE {0}", "%example.com"));</code></pre></noscript><p>I agree that this is a viable alternative and can make for shorter code.  Thanks.</p></div><h3>Simple.Data</h3><p>Finally Simple.Data offers a very clean syntax that mixes dynamic with concrete results.  The first thing you need to do with Simple.Data is get a handle on the Database object that is returned as a special <code>dynamic</code> object.  There are a number of ways of doing this,</p><script src='https://gist.github.com/1029142.js?file=SimpleData.cs'></script><noscript><pre><code>Simple.Data.Database.Open();Simple.Data.Database.OpenNamedConnection("DefaultConnectionString");Simple.Data.Database.OpenConnection(Program.ConnectionString);</code></pre></noscript><p>By using <code>Database.Open()</code> Simple.Data will look for a connection string called <code>Simple.Data.Properties.Settings.DefaultConnectionString</code> and use it to create the database instance.  Alternatively you can specify a specific named connection using <code>Database.OpenNamedConnection</code> or even a raw connection string using <code>Database.OpenConnection</code></p><p>These methods all return a special <code>dynamic</code> object that dynamically creates a <span class="caps">SQL</span> statement by constructing methods on the fly.  It&#8217;s best to look at the code for this.  To select a single object we can do this,</p><script src='https://gist.github.com/1029154.js?file=SimpleDataFind.cs'></script><noscript><pre><code>Author author = Simple.Data.Database.Open().Author.FindById(1);</code></pre></noscript><p>So whats happening here.  Well firstly we a asking it to look at the Authors table.  Next we are telling it to FindById &#8211; but this method doesn&#8217;t exist. We could easily have said FindByUsernameAndEmail and we would get the results we expected.  This bit of metaprogramming is the magic behind Simple.Data where method signatures are parsed and used to build <span class="caps">SQL</span>.  Nice stuff.  I still have a bit of issue working with dynamic objects but in this case my models are concrete so it&#8217;s really not an issue.</p><p>Selecting multiple objects is that same except instead of <code>FindByXXX</code> we use <code>FindAllByXXX</code> and as this query returns a <code>SimpleQuery</code> object we then need to perform a <code>.Cast&lt;Author&gt;</code> at the end to get back a list of authors.</p><p>An alternative and more flexible way of doing queries is using <code>Find</code> and <code>FindAll</code>.  These methods let you specify more complex queries.  To implement our <code>LIKE</code> comparison for our query above we need to use <code>FindAll</code> like so,</p><script src='https://gist.github.com/1029181.js?file=SimpleDataSelectMany.cs'></script><noscript><pre><code>dynamic authors = Simple.Data.Database.Open().Authors;IEnumerable&lt;Author&gt; authors = authors    .FindAll(authors.Username.Like("%.com"))    .Cast&lt;Author&gt;();</code></pre></noscript><p>This also shows the use of the <code>Cast&lt;T&gt;</code> mentioned above.  We can supply a variable number of arguments to <code>Find</code> and <code>FindAll</code> as well as using different comparison operators.</p><h2>That Was a Long One<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup></h2><p>So yeah not only have I touched on selecting single and multiple object at a high level I also had to add a bit of discussion around setting things up so I apologise for the length of this post.  On the plus side discussing configuration alone for MyBatis and nHibernate would probably take the same length of time.  Thats whats great about these microORMs 99% of the time you don&#8217;t need all that set up for most projects.  No need getting bogged down in configuration when it&#8217;s not actually achieving anything.</p><p>In terms of the syntax &#8211; so far I am quite taken by both Simple.Data and PetaPoco but that could change when I start really pushing things &#8211; after all everyone can do selects quite easily.</p><p>In terms of dynamic results (e.g. from Massive) I&#8217;m still to be convinced on their usefulness without having to always map to concrete classes.  I don&#8217;t see how this helps refactoring (it looks like it makes it much worse) nor do I see how it works with most validation mechanisms.  But I would love to be proven wrong on this please.</p><p>One thing I do know &#8211; it&#8217;s going to take a lot more justification for someone to use a heavyweight <span class="caps">ORM</span> in my next project.  While I not willing to declare the death of ORMs like some other people I am certainly leaning in that direction.</p><p>Source for this series is slowly evolving in a <a href="https://github.com/kouphax/microorm-comparison">Github repo</a> if you feel inspired to have a poke around.</p><p class="footnote" id="fn0"><a href="#fnr0"><sup>0</sup></a> We can argue about plural or singular data naming conventions some other time, or in the comments!!!</p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> I created a load of test data using the handy little tool <a href="http://autopoco.codeplex.com/">AutoPoco</a></p><p class="footnote" id="fn2"><a href="#fnr2"><sup>2</sup></a> &#8220;Thats what she said&#8221; &lt;self:facepalm&gt;</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/15/microorms-for-dotnet/">MicroORMs for .NET: (Obligatory) Introduction (Post)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-15T00:00:00+01:00" pubdate data-updated="true">Jun 15<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <blockquote class="announce">This post is the is part of series of posts covering the various microORMs in the .<span class="caps">NET</span> world.  I intend to look at how each microORM meets certain data access and manipulation needs.  The current series includes,<ul>	<li><a href="http://yobriefca.se/blog/2011/06/15/microorms-for-dotnet">Obligatory Introduction Post</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/16/microorms-for-dotnet-select-one">Syntax &#8211; SELECTs</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/18/microorms-for-dotnet-stored-procedures">Stored Procedures</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/21/microorms-for-dotnet-inserts-updates-deletes">Inserts, Updates &amp; Deletes</a><br></li></ul></blockquote><p>I&#8217;ve been playing, somewhat superficially, with a few MicroORMs in .<span class="caps">NET</span> for a while now.  While I have yet to use any in a real project I wanted to do a bit of comparison series.  It&#8217;s a bit selfish I guess as I am actually writing this series as a means to get myself up to speed on these frameworks as well as inform others about perils I faced as a newcomer to them as and when I hit those pain points.</p><p>To be honest I&#8217;ve never been a fan of the Data Access layer in projects &#8211; Databases are fine I guess and the application layer is all good but that thin layer between the two just frustrates me.  It&#8217;s often needlessly over complicated, confusing, hacked together or just plain broken.  Most of my experience is with <a href="http://www.mybatis.org/dotnet.html">iBatis/MyBatis</a> and it &#8220;does the job&#8221; but its very fiddly and <span class="caps">XML</span> configuration becomes cumbersome for simple tasks.  I&#8217;ve also tinkered with other things like Entity Framework and NHibernate but more often than not they just don&#8217;t feel right.</p><p>This make microORMs sound appealing to me for the very same reasons.  They give you just enough to get the job done, prefer convention over configuration and generally allow you to get right down to the metal and tweak things using <span class="caps">SQL</span> &#8211; easily the best <span class="caps">DSL</span> for working with databases.  Sure they may lack many features but typically these are features you wouldn&#8217;t really miss if taken away from you.</p><h2>The MicroORMs</h2><p>There are a number of ORMs currently available for .<span class="caps">NET</span> and I am going to look at a few of them in terms of features and syntax.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p><h3><a href="http://code.google.com/p/dapper-dot-net/">Dapper</a></h3><p>Dapper was created by Sam Saffron from <a href="http://stackoverflow.com">Stackoverflow</a>. Rather than a library Dapper is a single file that you can drop into your project and applies some syntactic sugar to extend your IDbConnection interface.</p><h3><a href="https://github.com/robconery/massive">Massive</a></h3><p>Like Dapper, Massive is a single file rather than a library and offers a very similar feature set to Dapper except it works exclusively with the .NET4 <code>dynamic</code> stuff.</p><h3><a href="http://www.toptensoftware.com/petapoco/">PetaPoco</a></h3><p>PetaPoco came out of inspiration from Massive and has extended to support real objects as well as some very nice extra features such as T4 templating, configuration via model attributes and other nice stuff.</p><h3><a href="https://github.com/markrendle/Simple.Data">Simple.Data</a></h3><p>Simple.Data is A lightweight, dynamic data access component that make use of convention and <code>dynamic</code> to allow users to access database tables via dynamically generated methods.</p><h3><a href="https://github.com/ServiceStack/ServiceStack.OrmLite">ORMLite</a></h3><p>ServiceStack.OrmLite is a convention-based, configuration-free lightweight <span class="caps">ORM</span> that uses standard <span class="caps">POCO</span> classes and Data Annotation attributes to infer its table schema.</p><h2>On with the show</h2><p>So thats my toys all laid out and ready to be played with.  Next step is to look at some of the typical operations for selecting and manipulating data from our database.  I hope to have the first real part of this investigation up shortly (or before the decade is out at least).</p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> This list is not exhaustive there are a few specialised ones around as well which I may touch on later in the series.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/09/baler-1-2-and-extensions/">Baler v0.2.1 Released and 2 New Extensions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-09T00:00:00+01:00" pubdate data-updated="true">Jun 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content">  <h1>Baler</h1><p>I have just released a new version of <a href="http://yobriefca.se/projects/baler">Baler</a>.  Version 0.2.1 release adds a new feature for adding custom attributes to bales.  The <code>Attr</code> function, available as an instance method to all bales, accepts an attribute name and a string value that will be applied to the rendered bale tag.  The best way to demonstrate this is with an example.</p><h2><span class="caps">CSS</span> Media Attribute</h2><p>When specifying link tags for <span class="caps">CSS</span> it is possible to scope that stylesheet to a specific meida type.  For example you could have a stylesheet that modifies your page style for printing e.g.</p><p class="minimal-gist"><script src="https://gist.github.com/1016555.js?file=style.css"></script></p><p>The new <code>Attr</code> method allows you to specify this new attribute like so,</p><p class="minimal-gist"><script src="https://gist.github.com/1016560.js?file=Baler.cs"></script></p><h2>&#8220;No Value&#8221; Attributes</h2><p>Some attributes, such as the <code>async</code> and <code>defer</code> on script tags do not require a value.  <code>Attr</code> is capable of dealing with these type of attributes.</p><p class="minimal-gist"><script src="https://gist.github.com/1016564.js?file=async.js"></script></p><p>Will produce</p><p class="minimal-gist"><script src="https://gist.github.com/1016565.js?file=script.html"></script></p><p>I am sure there are other uses for it (setting id&#8217;s or data-* attributes) as it&#8217;s a fairly flexible little enhancement.</p><h1><span class="caps">CSS</span> Media Extensions</h1><pre><code>PM&gt; Install-Package CodeSlice.Web.Baler.Extensions.CssMedia</code></pre><p>The first extension to utilise this new <code>Attr</code> is the <code>CssMediaExtensions</code> addon. <code>CssMediaExtensions</code> provide methods for setting the media type that a stylesheet should render for such as screen or print</p><h2>WithMedia()</h2><p>The WithMedia Extension allows you to set the media attribute of the rendered <span class="caps">CSS</span> tag.</p><p class="minimal-gist"><script src="https://gist.github.com/1016677.js?file=withmedia.cs"></script></p><h2>AsCss()</h2><p><code>AsCss</code> overrides the existing <code>AsCss</code> method allowing you to pass a media attribute value directly into the render call. For example the above example could simply be written as,</p><p class="minimal-gist"><script src="https://gist.github.com/1016682.js?file=ascss.cs"></script></p><h1>Named Bales Extension</h1><pre><code>PM&gt; Install-Package CodeSlice.Web.Baler.Extensions.NamedBales</code></pre><p>This one has been released for a while but I didn&#8217;t get around to writing about it. TheNamed Bales extension provides a mechanism to declare a Bale definition up front and reuse the same bale throughout the application without having to redefine the contents over and over. For example we can define a bale with 3 scripts and name it</p><p class="minimal-gist"><script src="https://gist.github.com/1016778.js?file=namedbale.cs"></script></p><p>This can returns the Bale itself so can be used inline or somewhere like <code>Global.asax</code>. Next we can render this bundle using <code>AsJs</code> later in the app like so,</p><p class="minimal-gist"><script src="https://gist.github.com/1016781.js?file=bale.cs"></script></p><p>Currently this doesn?t short circuit Balers internal cache so a second cache check will be made using the internal hashing mechanism. This is either a good thing or a bad thing. But for now it?s a good thing! This does have the side effect of ensuring that any unnamed bales with the same signature as a named bale will still get cached bale.</p><h3>NameAs()</h3><p>NameAs adds some sugar to the IBale interface allowing us to apply a friendly name to a bale. There is currently no check to see if the bale name is already taken. Existing definitions will be overwritten.</p><h3>NamedBales.Get()</h3><p>Allows us to retrieve a bale based on a friendly name defined by the developer. Will throw and exception if the bale name doesn?t exist in the cache ? otherwise the bale itself.</p><h1>Coming Up</h1><p>Still plenty to be done.  Docs are fairly complete but there are a mountain of unit tests to be written still and some extra features to be added (without bloating the code base of course).  I have a few features I&#8217;d like to work in but I&#8217;ll keep that for another day.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>All my thingz!</h1>
  <ul class="allmythings">
    <li><a href="http://speakerdeck.com/u/kouphax" style="text-decoration: none;"><img src="/images/social/speakerdeck.gif" height="32" width="32" title="Speakerdeck" /> Speakerdeck (Presentations)</a></li>
    <li><a href="http://bitbucket.org/kouphax" style="text-decoration: none;"><img src="/images/social/bitbucket.png" height="32" width="32" title="BitBucket" /> Bitbucket (Code)</a></li>
    <li><a href="http://github.com/kouphax" style="text-decoration: none;"><img src="/images/social/github.png" height="32" width="32" title="Github" /> Github (Code)</a></li>
    <li><a href="http://twitter.com/kouphax" style="text-decoration: none;"><img src="/images/social/twitter.png" height="32" width="32" title="Twitter" /> Twitter (Social)</a></li>
    <li><a href="http://vimeo.com/kouphax" style="text-decoration: none;"><img src="/images/social/vimeo.png" height="32" width="32" title="Vimeo" /> Vimeo (Screencasts)</a></li>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/12/sentamentalizer/">sentimentalizer: A Ruby port of Sentan</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/08/tinkering-with-minion-dot-js/">Tinkering with minion.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/06/taking-the-stairs/">Taking the Stairs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/12/the-estimation-4x4/">The Estimation 4x4</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/09/caveat-abstractor/">Caveat Abstractor</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("kouphax", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/kouphax" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @kouphax</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - James Hughes -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kouphax';
      
        
        if(window.dis_inpost){
          var disqus_identifier = 'http://yobriefca.se/blog/page/5/index.html';
          var disqus_url = 'http://yobriefca.se/blog/page/5/index.html';
          var disqus_script = 'embed.js';
        }else{
          var disqus_script = 'count.js';
        }

      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
