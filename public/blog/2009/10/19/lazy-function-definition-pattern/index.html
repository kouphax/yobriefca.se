
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Lazy Function Definition Pattern - Yo Briefcase!</title>
  <meta name="author" content="James Hughes">

  <link href='http://fonts.googleapis.com/css?family=Port+Lligat+Slab' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Fresca' rel='stylesheet' type='text/css'>

  
  <meta name="description" content="Have a look at this..Fairly simple function that loads the contents of a specific script tag (based on id) so that it can be used as a template (for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yobriefca.se/blog/2009/10/19/lazy-function-definition-pattern">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed" rel="alternate" title="Yo Briefcase!" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19143623-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="thingyattop" style="height:1px; background-color: #AAA; border-bottom: 1px solid #E0E0E0"></div>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
   
  <header>
                <span style="float:right">
      <a href="/" style="text-decoration:none;"><span class="label label-inverse">Home</span></a>
      <a href="/talks" style="text-decoration:none;"><span class="label label-inverse">Talks</span></a>
      <a href="/feed" style="text-decoration:none;"><span class="label">RSS</span></a>
      <a href="http://twitter.com/kouphax" style="text-decoration:none;"><span class="label">Twitter</span></a>
      <a href="http://github.com/kouphax" style="text-decoration:none;"><span class="label">Github</span></a>
    </span>
    
      <h1 class="entry-title">Lazy Function Definition Pattern</h1>
    

    
      <p class="meta">
        
          <span class="label" style="margin-right:10px;"><a href="/" style="text-decoration:none; text-transform:none; color:#fff">&larr;</a></span>
         
        








  


<time datetime="2009-10-19T00:00:00+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content">  <p>Have a look at this..</p><p><script src="https://gist.github.com/634652.js"></script></p><p>Fairly simple function that loads the contents of a specific script tag (based on id) so that it can be used as a template (for something).&nbsp;<span>&nbsp;</span>The&nbsp;reasons&nbsp;why you would do this is not important but the implementation of this function is. Every time you call this function you are re-selecting all the tag elements on the page which is just plain wrong. A quick fix for this would be to cache the results after the initial call and use the cache.</p><p><script src="https://gist.github.com/634653.js"></script></p><p>This would allow the the costly getElementsByTagName to be called once and the results reused. This however starts polluting the global namespace with unnecessary variables plus even if the getTemplate function is never used you still have the cost of one call to getElementsByTagName which is pretty poor. You can get around these issues fairly easily by extending the actual function object itself</p><p><script src="https://gist.github.com/634655.js"></script></p><p>The benefits of this approach are that you aren&rsquo;t polluting the global namespace and you are only making the call to getElementsByTagName ONLY when it is needed but it does still have an issue. The cache should only be available to the getTemplate functions internal logic but it is currently exposed allowing other functions to remove or update it.</p><p>Introducing the Lazy Function Definition Pattern. Thanks to the dynamic nature of JavaScript functions can actually redefine themselves at runtime and this allows us to provide private, lazy, one time processing without polluting the global namespace. Lets see it in action&hellip;</p><p><script src="https://gist.github.com/634658.js"></script></p><p>The big change here is the middle statement. getTemplate is actually redefining itself. So what happens here?</p><ol><li>On the first call getElementsByTagName is called and stored in the cache variable</li><li>The function then redefines itself as simple function that simply loops through the already defined cache</li><li>The function then calls itself (the new self!)</li></ol><p>Thanks to the creation of a&nbsp;<a href="http://www.jibbering.com/faq/faq_notes/closures.html">closure</a>&nbsp;the redefined function actually has access to the variables of the old definition &ndash; cache. This means that cache is private to the new function, only called once and not part of the global namespace. Exactly what I wanted. Programatically as well it&rsquo;s a better solution than the ones above because there are no checks to see if cache is defined saving a few cycles each call.</p></div>


  <footer>
    <p class="meta">
      








  


<time datetime="2009-10-19T00:00:00+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2009</time>
      

<span style="float:right">
  
    <a href='/blog/categories/javascript/' style='text-decoration:none;'><span class='label label-info'>javascript</span></a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://yobriefca.se/blog/2009/10/19/lazy-function-definition-pattern/" data-via="kouphax" data-counturl="http://yobriefca.se/blog/2009/10/19/lazy-function-definition-pattern/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/08/26/linqpad-don-t-let-the-name-fool-you/" title="Previous Post: LINQPad: Donât let the name fool you">&laquo; LINQPad: Donât let the name fool you</a>
      
      
        <a class="basic-alignment right" href="/blog/2009/11/23/-less-dynamic-css-for-net/" title="next Post: .less - Dynamic CSS for .NET">.less - Dynamic CSS for .NET &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <script>var dis_inpost = true;</script>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'kouphax';
      
        
        if(window.dis_inpost){
          var disqus_identifier = 'http://yobriefca.se/blog/2009/10/19/lazy-function-definition-pattern/';
          var disqus_url = 'http://yobriefca.se/blog/2009/10/19/lazy-function-definition-pattern/';
          var disqus_script = 'embed.js';
        }else{
          var disqus_script = 'count.js';
        }

      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
