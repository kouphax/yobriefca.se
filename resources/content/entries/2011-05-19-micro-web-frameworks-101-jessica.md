---
date: 2011-05-18T23:00:00Z
title: 'Micro Web Frameworks in .NET 101: Jessica'
published: true
categories: [.NET]
type: article
external: false
---
<p>Now I have got the <a href=":/blog/2011/05/18/why-would-you-use-micro-web-frameworks-in-net">opinion piece</a> out of the way I can start the bit I like - dissecting the various technologies that could be classed as <em>micro web frameworks</em>.  First on the table is <a href=":http://jessicafx.org">Jessica</a>.</p><h2>Getting Started - Hello World</h2><p>Getting a simple Hello World set up in <a href=":http://jessicafx.org">Jessica</a> involves (optionally) taking more out than you put in.  <a href=":http://jessicafx.org">Jessica</a> requires very little configuration so creating a new web project, deleting all the extra files and folders, trimming the <code>web.config</code> and emptying the <code>Global.asax.cs</code> makes for a nice blank canvas to start with.</p><p class="img-holder"><img alt="" src="/images/blog/project-before-and-after.png" /></p><p>Next step is pretty difficult :-).  Within the <a href="http://nuget.org">NuGet</a> Package Manager Console just install the Jessica package</p><p class="minimal-gist"></p><div class="highlight"><pre><code><span class="n">Install-Package</span> <span class="n">Jessica</span>
</code></pre></div>
<p>Once installed be need to tell Jess to initialise/bootstrap itself when the application starts by calling the initialise method in the <code>Application_Start</code> method of the <code>Global.asax.cs</code></p><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Global</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Jess</span><span class="p">.</span><span class="n">Initialise</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>At this point it's also possible to supply a number of configuration options but we will touch on this later along with the optional configuration <span class="caps">XML</span>.  Now that Jess is setup to configure itself all we need to do now is define the module that will handle our complex Hello World output.</p><p>Modules form the basis of Jessica each one holding a number of routes (based on URL's and <span class="caps">HTTP</span> verbs) and associated actions.  Our app will have a single module,</p><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">MainModule</span> <span class="p">:</span> <span class="n">JessModule</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">MainModule</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="s">"Hello World"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This simple module defines a single route that will match any standard <code>GET</code> request for the root of the app. And that's it.  When you run the app Jess will inspect the assembly and find all the modules and wire up the routes.</p><h2>The Rest of the Pie</h2><p>Obviously serving plain bits of text is a bit useless so there are plenty of things that Jessica offers that makes it, well, actually useful.</p><h3>Configuration</h3><p>Jessica can be configured programatically or via <span class="caps">XML</span> config.  A number of things you can currently set include,</p><ul>	<li>Environment - the environment you build in e.g. <code>development</code>, <code>test</code>, <code>release</code>.  Default <code>development</code></li>	<li>Public Directory - The directory to be used to server static content (html, js, css, images) that require no preprocessing. Default <code>public</code></li>	<li>Views Directory - The directory to be used to serve views that can be dynamically rendered (Razor, Textile, Markdown, Liquid etc.).  Default <code>views</code></li></ul><p>The <span class="caps">XML</span> config is outlined below but each of these properties can be set in the <code>Global.asax.cs</code> programatically as well via the <code>Jess.Configuration</code> properties.</p><div class="highlight"><pre><code><span class="nt">&lt;configSections&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">"jessica"</span> 
             <span class="na">type=</span><span class="s">"Jessica.Configuration.JessicaConfiguration,Jessica"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/configSections&gt;</span>
    
<span class="nt">&lt;jessica</span> <span class="na">environment=</span><span class="s">"development"</span> 
         <span class="na">publicDir=</span><span class="s">"Public"</span> 
         <span class="na">viewsDir=</span><span class="s">"Views"</span><span class="nt">/&gt;</span>
</code></pre></div>
<h3>Routes and Actions</h3><p>Routes may be defined as a literal path such as <code>/users</code> or <code>/store/toys</code> or with variable segments such as <code>/user/:id</code> or <code>/blog/:year/:month/:day</code>.  Variable segments are then parsed out of the route url and the values added to the action argument.</p><p class="minimal-gist"></p><div class="highlight"><pre><code><span class="n">Get</span><span class="p">(</span><span class="s">"/blog/:year/:month/:day"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> 
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">blog</span> <span class="p">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">day</span><span class="p">);</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="s">"blog"</span><span class="p">,</span> <span class="n">blog</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>That seems to be about the extent of the route manipulation for now.  Would be nice to see the other Sinatra stuff included such as <a href="http://www.sinatrarb.com/intro#Routes">splats</a>, <a href="http://www.sinatrarb.com/intro#Routes">regular expressions</a> and <a href="http://www.sinatrarb.com/intro#Conditions">conditions</a>.</p><p>Actions are fairly simple they take a dynamic object and are expected to return a Jessica <code>Response</code> object.  The dynamic object passed in contains a number of things such as route parameters, querystring parameters and the current HttpContext.  As an added niceness the Jessica <code>Response</code> object has a number of <a href="http://msdn.microsoft.com/en-us/library/z5z9kes2(v=vs.71).aspx">implicit</a> type conversions that allow us to return simpler objects</p><div class="highlight"><pre><code><span class="k">public</span> <span class="nf">MainModule</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// string -&gt; text/html</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="s">"Hello World"</span><span class="p">);</span>

    <span class="c1">// int -&gt; http status code</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="m">404</span><span class="p">);</span>                             

    <span class="c1">// Action&lt;Response&gt; -&gt; Response stream</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsText</span><span class="p">(</span><span class="s">"Test"</span><span class="p">));</span> 
<span class="p">}</span>
</code></pre></div>
<h3>Static Content</h3><p>Jessica allows us to return static content simply.  First of all all routes are first checked for the existence of a file at that <span class="caps">URL</span>.  If a file is found it is served, if not then Jessica goes to the route table and works it's magic.  Putting resources in the <code>publicDir</code> allows Jessica to serve static content from the route actions and the <code>Response</code> object comes with a number of nice helpers to help make your static actions neater.</p><div class="highlight"><pre><code><span class="k">public</span> <span class="nf">MainModule</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsCss</span><span class="p">(</span><span class="s">"test.css"</span><span class="p">));</span> 
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsFile</span><span class="p">(</span><span class="s">"trojanz.exe"</span><span class="p">,</span> <span class="s">"application/application"</span><span class="p">));</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsHtml</span><span class="p">(</span><span class="s">"test.html"</span><span class="p">));</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsJs</span><span class="p">(</span><span class="s">"test.js"</span><span class="p">));</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsJson</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"James"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">31</span> <span class="p">}));</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsRedirect</span><span class="p">(</span><span class="s">"http://www.google.com"</span><span class="p">));</span>
    <span class="n">Get</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">AsText</span><span class="p">(</span><span class="s">"test"</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<h3>Views</h3><p>What web technology would be complete without the ability to serve non-static views?  Oddly enough Jessica, out of the box at least, comes with no view engines.  I suspect this is because dynamic view rendering isn't technically something that should form the basis of a web framework - thats the job of the view engines.  Jessica does however come with an extension point of adding X amount of view engines - <code>Jess.ViewEngines</code>.  There is also a healthy volume of view engines available for Jessica,</p><ul>	<li><a href="http://nuget.org/List/Packages/Jessica-ViewEngine-Razor">Razor</a></li>	<li><a href="http://nuget.org/List/Packages/Jessica-ViewEngine-Spark">Spark</a></li>	<li><a href="http://nuget.org/List/Packages/Jessica-ViewEngine-DotLiquid">DotLiquid</a></li>	<li><a href="http://nuget.org/List/Packages/Jessica-ViewEngine-Markdown">Markdown</a></li>	<li><a href="http://nuget.org/List/Packages/Jessica-ViewEngine-Textile">Textile</a></li></ul><p>Rendering a view from an action is also very simple</p><div class="highlight"><pre><code><span class="k">public</span> <span class="k">class</span> <span class="nc">MainModule</span> <span class="p">:</span> <span class="n">JessModule</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">MainModule</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Get</span><span class="p">(</span><span class="s">"/user/"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">View</span><span class="p">(</span><span class="s">"index"</span><span class="p">));</span>
        <span class="n">Get</span><span class="p">(</span><span class="s">"/user/:username"</span><span class="p">,</span> <span class="n">r</span> <span class="p">=&gt;</span> <span class="n">View</span><span class="p">(</span><span class="s">"user"</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">username</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The first option renders a simple view called index while the second takes a model object that is pushed into the scope of the view and can be used to build the view.  Jessica will loop through it's <code>ViewEngines</code> collection and attempt to resolve the view name to a file in the specified <code>viewsDir</code> folder.  If it finds a matching view it will render it.</p><p>I am going to take the lead from Jessica itself and not dive into the various view choices for now.  They are pretty self explanatory anyway.</p><h2>Summing Up</h2><p>So thats the 101, the skinny, the lowdown, the starter for 10, the basics and other random statements of <a href=":http://jessicafx.org">Jessica</a>. Hopefully this covers the vast majority of what v0.83 of Jessica offers.  It's a nice minimla framework that attempts to stick to Sinatra's philosophy.  It would be nice to see a few more of Sinatras features creeping in especially route <a href="http://www.sinatrarb.com/intro#Conditions">conditions</a>.  There is also some nice high level error handling being introduced (for v0.9 I assume) for handling application wide errors and 404's.  I plan on talking about these when they make an appearance.</p><p>Corrections, comments and criticisms below please.</p>