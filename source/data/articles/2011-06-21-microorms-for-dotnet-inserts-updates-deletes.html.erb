---
layout: post
published: true
title: "MicroORMs for .NET: Inserts, Updates &amp; Delete"
categories: [".NET", MicroORMs, Dapper, ORMLite, Massive, PetaPoco, "Simple.Data", "MicroORMs for .NET Series"]
---
  <blockquote class="announce">This post is the is part of series of posts covering the various microORMs in the .<span class="caps">NET</span> world.  I intend to look at how each microORM meets certain data access and manipulation needs.  The current series includes,<ul>	<li><a href="http://yobriefca.se/blog/2011/06/15/microorms-for-net-obligatory-introduction-post">Obligatory Introduction Post</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/16/microorms-for-net-syntax-selects">Syntax &#8211; SELECTs</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/18/microorms-for-net-stored-procedures">Stored Procedures</a></li>	<li><a href="http://yobriefca.se/blog/2011/06/21/microorms-for-net-inserts-updates-and-delete">Inserts, Updates &amp; Deletes</a><br></li></ul></blockquote><p>Moving swiftly on, if all our solutions only used different way to select data then how would we ever get data into our solution?  So lets look at how these microORMs handle Inserts, Updates and Deletes<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>.  These examples will follow on from previous ones so I am only going publish the key lines.  If you want the complete code you can grab them from the <a href="https://github.com/kouphax/microorm-comparison">GitHub project</a>.</p><h2>Dapper</h2><h3>Insert</h3><p>Nothing unexpected here.  More <span class="caps">SQL</span>.  Sam Saffron previously pointed me in the direction of <a href="http://code.google.com/p/dapper-dot-net/source/browse/Dapper.Contrib/Extensions/SqlMapperExtensions.cs">Dapper.Contrib</a> that has extra extension methods for doing things like <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> but at the time of trying I couldn&#8217;t get it to work and have an <a href="https://github.com/SamSaffron/dapper-dot-net/issues/8">open issue</a> on GitHub.  If I get an update on this I&#8217;ll post the slightly cleaner syntax.</p><p class="minimal-gist"><script src='https://gist.github.com/1036689.js?file=DapperInsert.cs'></script><noscript><pre><code>conn.Open();int count = conn.Execute(    "INSERT Authors(Username, FullName, CreatedDate) " +    "VALUES (@Username, @FullName, GETDATE())",    new { Username = "james@dapper.net", FullName = "James Hughes" });</code></pre></noscript></p><h3>Update</h3><p>Update is very similar to insert.  The nice thing about this approach vs. using POCOs is that you only need to send the delta of the object up where as with the other approaches you may have to fetch the object before updating.</p><p class="minimal-gist"><script src='https://gist.github.com/1037727.js?file=DapperUpdate.cs'></script><noscript><pre><code>int count = conn.Execute(    "UPDATE Authors SET FullName = @FullName WHERE Id = @Id",    new { FullName = "James Hughes", Id = 1 });</code></pre></noscript></p><h3>Delete</h3><p>Delete is pretty much what you&#8217;d expect.  I&#8217;ll update these examples when I get my problems with Dapper.Contrib sorted but when you are so close to the <span class="caps">SQL</span> metal there isn&#8217;t a massive amount to discuss.</p><p class="minimal-gist"><script src='https://gist.github.com/1037737.js?file=DapprDelete.cs'></script><noscript><pre><code>int count = conn.Execute(    "DELETE FROM Authors WHERE Id = @Id",    new { Id = 1 });</code></pre></noscript></p><h2>Massive</h2><h3>Insert</h3><p>Massive keeps things simple as usual.  <code>Insert</code> can take POCOs as well as dynamic object (and a number of other types) and it uses the info found in the <code>Authors</code> DynamicModel class to generate the <span class="caps">SQL</span> for you.</p><p class="minimal-gist"><script src='https://gist.github.com/1036724.js?file=MassiveInsert.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Insert(new {    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>As a bonus feature Massive can wrap multiple inserts in a single transaction and perform multiple inserts at once.</p><p class="minimal-gist"><script src='https://gist.github.com/1037434.js?file=MassiveInsertMany.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.InsertMany( new [] {    { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now },     { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now },     { Username = "james@dapper.net", FullName = "James Hughes", CreatedDate = DateTime.Now } });</code></pre></noscript></p><h3>Update</h3><p>Like Dapper, Massive allows us to send only a delta between the old and new object.</p><p class="minimal-gist"><script src='https://gist.github.com/1037745.js?file=MassvieUpdate.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Update(new {    FullName = "James Hughes"}, 1);</code></pre></noscript></p><p>Massive also gets extra points for the <code>UpdateMany</code> that, not suprisingly, behaves like the <code>InsertMany</code> method mentioned above (except for updates of course).</p><h3>Delete</h3><p>Ultra simple approach to Deleting specific objects just pass in an id and you&#8217;re done,</p><p class="minimal-gist"><script src='https://gist.github.com/1037749.js?file=MassiveDelete.cs'></script><noscript><pre><code>var tbl = new Authors();var x = tbl.Delete(2);</code></pre></noscript></p><h2>PetaPoco</h2><h3>Insert</h3><p>PetaPoco offers 2 main ways to insert your data<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup>.  You can pass in a plain <span class="caps">POCO</span> (or in our case on that uses attributes to normalise the difference between the schema and the C# class),</p><p class="minimal-gist"><script src='https://gist.github.com/1037467.js?file=PetaPocoInsert1.cs'></script><noscript><pre><code>PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString");var x = db.Insert(new Author{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Or you can pass in an anonymous object specifying the table and primary key field,</p><p class="minimal-gist"><script src='https://gist.github.com/1037469.js?file=PetaPocoInsert2.cs'></script><noscript><pre><code>var x = db.Insert("Authors", "Id", new{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><h3>Update</h3><p>There are plenty of ways to update data using PetaPoco.  The first one is to pass in your model object and the row will get updated.  I am creating a new object in this example but you could just fetch it from the database as you&#8217;d expect,</p><p class="minimal-gist"><script src='https://gist.github.com/1037781.js?file=PetaPocoUpdate1.cs'></script><noscript><pre><code>PetaPoco.Database db = new PetaPoco.Database("DefaultConnectionString");var x = db.Update(new Author{    Id = 9,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Another approach is to just pass up a delta of the changes,</p><p class="minimal-gist"><script src='https://gist.github.com/1037784.js?file=PetaPocoUpdate2.cs'></script><noscript><pre><code>var x = db.Update("Authors", "Id", new{    Id = 10,    FullName = "James Hughes"});</code></pre></noscript></p><p>Alternatively you can simply pass up the delta and specify the primary key value externally,</p><p class="minimal-gist"><script src='https://gist.github.com/1037789.js?file=PetaPocoUpdate3.cs'></script><noscript><pre><code>db.Update("Authors", "Id", new { FullName = "James Hughes" }, 12);</code></pre></noscript></p><p>Variety is the spice of life in PetaPoco!</p><h3>Delete</h3><p>Thanks to the custom attribute on our Author class deleting a record is a matter of passing the Id to the <code>Delete</code> method,</p><p class="minimal-gist"><script src='https://gist.github.com/1037792.js?file=PetaPocoDelete.cs'></script><noscript><pre><code>db.Delete&lt;Author&gt;(8);</code></pre></noscript></p><h2>ServiceStack ORMLite</h2><h3>Insert</h3><p>ORMLite is pretty much inline with the other microORMs a simple <code>Insert</code> method that accepts a <span class="caps">POCO</span> or an anonymous object and generates <span class="caps">SQL</span> based on the info given.  This can be done in one of two ways,</p><p class="minimal-gist"><script src='https://gist.github.com/1037549.js?file=ORMLiteInsert1.cs'></script><noscript><pre><code>using (IDbConnection db = Program.ConnectionString.OpenDbConnection())using (IDbCommand cmd = db.CreateCommand()){    cmd.Insert&lt;Author&gt;(new Author    {        Username = "james@dapper.net",        FullName = "James Hughes",        CreatedDate = DateTime.Now    });}</code></pre></noscript></p><p>Or the factory approach discussed in the first article,</p><p class="minimal-gist"><script src='https://gist.github.com/1037551.js?file=ORMLiteInsert2.cs'></script><noscript><pre><code>IDbConnectionFactory dbFactory = new OrmLiteConnectionFactory(    Program.ConnectionString,    SqlServerOrmLiteDialectProvider.Instance);<p><p>dbFactory.Exec(dbCmd =&gt; dbCmd.Insert<author>(new Author<br>{<br>    Username = &#8220;james@dapper.net&#8221;,<br>    FullName = &#8220;James Hughes&#8221;,<br>    CreatedDate = DateTime.Now<br>}));</author></code></pre></noscript></p><h3>Update</h3><p>ORMLite sticks with one approach for updating a row &#8211; passing in a <span class="caps">POCO</span> that it can map to a table/row,</p><p class="minimal-gist"><script src='https://gist.github.com/1037796.js?file=ORMLiteUpdate.cs'></script><noscript><pre><code>cmd.Update(new Author{    Id = 7,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>If you really don&#8217;t want to fetch your row again and only want to send up a delta you&#8217;ll have to roll your own approach (simple enough though).</p><h3>Delete</h3><p>ORMLite supports a number of neat ways to delete rows,</p><ul>	<li><code>DeleteById(id)</code></li>	<li><code>Delete(where_clause, id)</code></li>	<li><code>Delete(object)</code></li></ul><p class="minimal-gist"><script src='https://gist.github.com/1037807.js?file=ORMLiteDelete.cs'></script><noscript><pre><code>cmd.DeleteById&lt;Author&gt;(5);cmd.Delete&lt;Author&gt;("Id = @0", 6);cmd.Delete(new Author { Id = 7 });</code></pre></noscript></p><h2>Simple.Data</h2><h3>Insert</h3><p>Guess what Simple.Data&#8217;s approach is once again very fluent, clean and easy to understand.  OK I don&#8217;t get Intellisense as the methods are dynamic but I didn&#8217;t need it anyway.</p><p class="minimal-gist"><script src='https://gist.github.com/1037553.js?file=SimpleDataInsert.cs'></script><noscript><pre><code>Author x =  Simple.Data.Database.Open().Author.Insert(new Author{    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><h3>Update</h3><p>Simple.Data has 2 ways of updating.  <code>Update</code> takes a <span class="caps">POCO</span> and maps the id to the specific row,</p><p class="minimal-gist"><script src='https://gist.github.com/1037803.js?file=SimpleDataUpdate1.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.Update(new Author{    Id = 5,    Username = "james@dapper.net",    FullName = "James Hughes",    CreatedDate = DateTime.Now});</code></pre></noscript></p><p>Alternatively Simple.Data supports the delta approach too using <code>UpdateById</code></p><p class="minimal-gist"><script src='https://gist.github.com/1037804.js?file=SimpleDataUpdate2.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.UpdateById(    Id: 6,     FullName: "James Hughes");</code></pre></noscript></p><h3>Delete</h3><p>Finally Simple.Data has 2 ways to delete a record,</p><ul>	<li><code>DeleteById(id)</code></li>	<li><code>Delete(named_parameters)</code></li></ul><p class="minimal-gist"><script src='https://gist.github.com/1037813.js?file=SimpleDataDelete.cs'></script><noscript><pre><code>Simple.Data.Database.Open().Authors.DeleteById(3);Simple.Data.Database.Open().Authors.Delete(Id: 4);</code></pre></noscript></p><h2>There We Have It</h2><p>OK OK I guess this post feels a bit rushed.  I started out throwing lots of details into selects and stuff but this one just isn&#8217;t up to par.  I slowly discovered that I&#8217;d have to spend almost all my spare time covering all the aspects I wanted.  So I cut it back to a kind of &#8220;Starter for 10&#8221; approach.  Yeah thats right I&#8217;m leaving stuff up to you to ask and research :-P.  Anyway in these basic examples no one <span class="caps">ORM</span> really stands out too much.  Simple.Data is, as always, lovely and clean and PetaPoco offers a very flexible experience.  I like the ability to send deltas instead of full objects back (in case you hadn&#8217;t guessed) and I had a few annoyances around updates using Massive and Dapper but I think it was my own stupidity (I&#8217;ll update when I investigate).  If I had to choose between them I am still tending towards Simple.Data and PetaPoco (probably PetaPoco at this stage) but I do find all of them a much more pleasant experience vs. MyIbatis or NHibernate.</p><p>That should be enough to start anyone off on the right foot.</p><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Hehehehe IUDs</p><p class="footnote" id="fn2"><a href="#fnr2"><sup>2</sup></a> You can pass a <span class="caps">SQL</span> string or a <span class="caps">SQL</span> builder as well but it&#8217;s fairly straightforward so I&#8217;ll not cover it here.  See the original <a href="http://yobriefca.se/blog/2011/06/16/microorms-for-net-syntax-selects"><span class="caps">SELECT</span> post</a> for a <span class="caps">SQL</span> and <span class="caps">SQL</span> Builder example.</p>