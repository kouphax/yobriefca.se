<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" /> 
        <title>Documentation</title>
        
        <link rel="stylesheet" href="../style.css" type="text/css" media="screen" charset="utf-8"> 
        
        <link href="../js/prettify.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="../js/prettify.js"></script>
    </head>
    <body  class="manual" onload="prettyPrint()">
      <div class="container"> 

        <div class="nav"> 
          <ul> 
            
            <li class="first"><a href="../">Home</a></li>
            <li><a href="../docs">Documentation</a></li> 
            <li><a href="../ext/">Extensions</a></li> 
            <li><a href="../src/baler/Baler.html">Annotated Source</a></li> 
          </ul> 
        </div>
        
        <div style="clear:both">&nbsp;</div>
<h1>Baler Documentation</h1>
<p>Baler is a .<span class="caps">NET</span> based lightweight, extensible utility for building JavaScript and <span class="caps">CSS</span> bundles that can be used in many .<span class="caps">NET</span> Based Web Frameworks.  Baler aims to provide the minimum feature set required achieve its goals so it&#8217;s cruft free and feature fit while offering the ability to extend and control Balers behaviour.</p>
<p>Baler doesn&#8217;t rely on any dlls other than <code>System.Web</code> so it should integrate well with any web .<span class="caps">NET</span> web framework that supports execution of C# within its views.  It is built against .NET4 for now.</p>
<hr/>

<ul>
	<li><a href="#section_1">1 Installation</a>
	<ul>
		<li><a href="#section_1_1">1.1 Installing From NuGet</a></li>
		<li><a href="#section_1_2">1.2 Installing From Github</a></li>
	</ul></li>
	<li><a href="#section_2">2 Getting Started</a></li>
	<li><a href="#section_3">3 Baler</a>
	<ul>
		<li><a href="#section_3_1">3.1 Build</a></li>
		<li><a href="#section_3_2">3.2 Caching</a></li>
		<li><a href="#section_3_3">3.3 Configuration</a>
		<ul>
			<li><a href="#section_3_3_1">3.3.1 Configuration Options</a></li>
		</ul></li>
	</ul></li>
	<li><a href="#section_4">4 Bales</a>
	<ul>
		<li><a href="#section_4_1">4.1 AsJs</a></li>
		<li><a href="#section_4_2">4.2 AsCss</a></li>
		<li><a href="#section_4_3">4.3 Attr</a></li>
	</ul></li>
	<li><a href="#section_5">5 Extensions</a>
	<ul>
		<li><a href="#section_5_1">5.1 Writing Extensions</a>
		<ul>
			<li><a href="#section_5_1_1">5.1.1 Before</a></li>
			<li><a href="#section_5_1_2">5.1.2 After</a></li>
			<li><a href="#section_5_1_3">5.1.3 Order</a></li>
		</ul></li>
		<li><a href="#section_5_2">5.2 Available Extensions</a></li>
	</ul></li>
	<li><a href="#section_6">6 Changelog</a></li>
	<li><a href="#section_7">7 Contributors</a></li>
	<li><a href="#section_8">8 License</a></li>
</ul>
<h2 id="section_1">1 Installation</h2>
<h3 id="section_1_1">1.1 Installing From NuGet</h3>
<p>The easiest way to install the latest and greatest Baler is via <a href="http://nuget.org">Nuget</a>.  Just use the Package Browser or from the Package Manager Console type,</p>
<pre class="prettyprint"><code class="prettyprint">PM&gt; Install-Package CodeSlice.Web.Baler</code></pre>
<p>Bundler has no strange dependencies so that should be all you need to do to start using it.</p>
<h3 id="section_1_2">1.2 Installing From Github</h3>
<p>Alternatively it is possible to build Baler from source.  Just clone or download the <a href="https://github.com/kouphax/baler">Github repository</a>, open the solution file and build.</p>
<h2 id="section_2">2 Getting Started</h2>
<p>You will use the <code>Build</code> method to construct your bales.  Just add a reference to the Baler namespace whichever way you want,</p>
<pre class="prettyprint"><code class="prettyprint">&lt;%@ Page Language="C#" AutoEventWireup="true" 
    CodeBehind="Default.aspx.cs" 
    Inherits="CodeSlice.Web.Test.Default" %&gt;
&lt;%@ Import Namespace="CodeSlice.Web.Baler" %&gt;
&lt;!DOCTYPE HTML /&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Next we need to tell Baler to construct a bale from a number of scripts</p>
<pre class="prettyprint"><code class="prettyprint">&lt;head&gt;
  &lt;%=
    Baler.Build(
      "~/scripts/script1.js",
      "~/scripts/script2.js",
      "~/scripts/script3.js",
    )
  %&gt;
&lt;/head&gt;</code></pre>
<p>Finally we need to specify how we should render this bundle.  We&#8217;ve included a number of javascript files so let&#8217;s render it as JavaScript.</p>
<pre class="prettyprint"><code class="prettyprint">&lt;%=
  Baler.Build(
    "~/scripts/script1.js",
    "~/scripts/script2.js",
    "~/scripts/script3.js",
  ).AsJs()
%&gt;</code></pre>
<p>The our final markup should look like this,</p>
<pre class="prettyprint"><code class="prettyprint">&lt;%@ Page Language="C#" AutoEventWireup="true" 
    CodeBehind="Default.aspx.cs" 
    Inherits="CodeSlice.Web.Test.Default" %&gt;
&lt;%@ Import Namespace="CodeSlice.Web.Baler" %&gt;
&lt;!DOCTYPE HTML /&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;%=
      Baler.Build(
        "~/scripts/script1.js",
        "~/scripts/script2.js",
        "~/scripts/script3.js",
      ).AsJs()
    %&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Now if you run this you should see a single <code>&lt;script /&gt;</code> tag pointing to the concatenated bale with the contents of all 3 scripts.</p>
<h2 id="section_3">3 Baler</h2>
<p><code>Baler</code> is the main class used in the Baler solution.  It is defined as a singleton and is responsible for two things,</p>
<ol>
	<li>Providing a mechanism for building/defining bales, and,</li>
	<li>Providing a simple caching mechanism to reduce unnecessary rebuilding of bales.</li>
</ol>
<h3 id="section_3_1">3.1 Build</h3>
<p>The <code>Build</code> method offers a starting point for defining <em>bales</em> or resource bundles based on a collection of files.</p>
<pre class="prettyprint"><code class="prettyprint">public static IBale Build(params string[] items);</code></pre>
<p><code>Build</code> accepts a variable number of string arguments were each argument is an absolute <span class="caps">URL</span> to a file hosted by the web app and returns the bale definition that can be processed for output to the page.  So to define a bale that bundles 3 scripts from the <code>~/Scripts</code> directory we can do this.</p>
<pre class="prettyprint"><code class="prettyprint">Baler.Build(
  "~/Scripts/script1.js",
  "~/Scripts/script2.js",
  "~/Scripts/script3.js"
)</code></pre>
<p>However this will not actually result in a <code>&lt;script /&gt;</code> tag being output to the page.  That is the responsibility of the bale itself.</p>
<h3 id="section_3_2">3.2 Caching</h3>
<p>Baler employs a very simple caching mechanism to reduce the risk of re-bundling the same files over and over.  This is currently handled internally so you don&#8217;t need to worry too much about it but for the inquisitive amongst you here&#8217;s a brief explanation.</p>
<p>When the <code>Build</code> method receives an array of resource references these are joined together and hashed.  This hash is used as a lookup on the internal in-memory cache &#8211; if the key exists the paired Bale is returned.  If it doesn&#8217;t exist then the Bale is constructed and cached against the hash for the next time.</p>
<p>This mechanism ensures that no matter how many pages a bale is defined in the bale won&#8217;t be needlessly reconstructed, provided of course that the files are the same and they are in the same order.</p>
<h3 id="section_3_3">3.3 Configuration</h3>
<p>Baler currently offers very little in the way of configuration as the old adage of <em>convention over configuration</em> is very much alive.  Not to mention the fact there is very little configuration required.</p>
<p>The configuration of Baler is made available through the <code>Configuration</code> property.</p>
<h4 id="section_3_3_1">3.3.1 Configuration Options</h4>
<table style="width:100%; margin-top:20px;">
	<tr>
		<td><strong>Option Name</strong></td>
		<td><strong>Description</strong></td>
		<td><strong>Default Value</strong></td>
	</tr>
	<tr>
		<td><code>OutputPath</code></td>
		<td>Place to output all bale files to</td>
		<td><em>~/Scripts</em></td>
	</tr>
</table>
<h2 id="section_4">4 Bales</h2>
<p>Bales are vehicle by which all web resources are processed and delivered.  The Baler is responsible for producing bales but the bale itself is responsible for processing it&#8217;s content.  All bales must adhere to the <code>IBale</code> interface but can be <a href="#section_5_1">extended</a> through the use of extension methods (the recommended but optional approach).</p>
<h3 id="section_4_1">4.1 AsJs</h3>
<pre class="prettyprint"><code class="prettyprint">public string AsJs();</code></pre>
<p><code>AsJs</code>, as the name suggests, will process the bale and return the corresponding <code>script</code> tag pointing to the generated bale,</p>
<pre class="prettyprint"><code class="prettyprint">Baler.Build(...).AsJs() </code></pre>
<p>Would produce a tag similar to,</p>
<pre class="prettyprint"><code class="prettyprint">&lt;script type="text/javascript" src="..."&gt;&lt;/script&gt;</code></pre>
<h3 id="section_4_2">4.2 AsCss</h3>
<pre class="prettyprint"><code class="prettyprint">public string AsCss();</code></pre>
<p>Exactly the same as <code>AsJs</code> except that it will produce the relevant <code>link</code> tag</p>
<pre class="prettyprint"><code class="prettyprint">Baler.Build(...).AsCss() </code></pre>
<p>Would produce a tag similar to,</p>
<pre class="prettyprint"><code class="prettyprint">&lt;link rel="stylesheet" href="..." type="text/css"  /&gt; </code></pre>
<h3 id="section_4_3">4.3 Attr</h3>
<pre class="prettyprint"><code class="prettyprint">public IBale Attr(string name, string value);</code></pre>
<p>Attr can be used to add a variable number of custom attributes to the generated tag that the bale produces when rendered.  This is useful for adding things like the <code>media</code> attribute to css bales or the <code>async</code> etc.</p>
<h2 id="section_5">5 Extensions</h2>
<p>Extension methods are the recommended way of adding Baler extensions as they can be setup to support chaining and adhere to the semi-fluent <span class="caps">API</span> already in place.</p>
<h3 id="section_5_1">5.1 Writing Extensions</h3>
<p>Baler supports 2 main hooks for manipulating the content of a bundle.  This makes it possible to apply new behaviour to determine how the bundle or files within the bundle are processed.</p>
<h4 id="section_5_1_1">5.1.1 Before</h4>
<p>A bales <code>Before</code> method provides the ability to manipulate each item in the bale in turn.  It receives the path to the original item and the content of the item and expects to return the transformed content.  Multiple <code>Befores</code> can be specified.</p>
<h4 id="section_5_1_2">5.1.2 After</h4>
<p>A bales <code>After</code> method provides the ability to manipulate the entire bale before it is written to the output file.  It receives just the content and expects to return the transformed contents. Multiple <code>Afters</code> can be specified.</p>
<h4 id="section_5_1_3">5.1.3 Order</h4>
<p>Both the <code>Before</code> and <code>After</code> methods can accept an optional <code>order</code> parameter that can be used to control the order of execution.  For example the MS Ajax Minifier Extension need to run after all other possible transforms so it is given an order of 999 to prevent it executing early.</p>
<h4 id="section_5_1_4">5.1.4 Quick Example</h4>
<p>The following code demonstrates a simple extension that applies Rot13 encoding to the bale contents before outputting (because that&#8217;s a very sensible thing to do)<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>. It adds 2 methods to a bale that do the same thing except one operates on the entire bale and the other operates on a per item basis (just as an example).</p>
<pre class="prettyprint"><code class="prettyprint">public static class Rot13Extensions
{
  public static IBale Rot13All(this IBale bale)
  {
    return bale.After(c =&gt; { Rot13.Encode(c) });
  }
  public static IBale Rot13Each(this IBale bundle)
  {
    return bundle.Before((f, c) =&gt; { Rot13.Encode(c) });
  }
}</code></pre>
<p>This could then be called like so</p>
<pre class="prettyprint"><code class="prettyprint">Baler.Build(...).Rot13All().AsJs()</code></pre>
<p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> <sup>You may be disappointed to hear that the Rot13 extension isn&#8217;t officially supported.</sup></p>
<h3 id="section_5_2">5.2 Available Extensions</h3>
<p>See the <a href="../ext">Extensions</a> page for a list of officially supported and community contributed Baler extensions.  Also feel free to submit your own for the kudos.</p>
<h2 id="section_6">6 Changelog</h2>
<ul>
	<li><strong>0.4.1</strong> (July 10 <sup>th</sup>, 2011):
	<ul>
		<li>Added VS2008 files to source</li>
	</ul></li>
</ul>
<ul>
	<li><strong>0.4.0</strong> (June 20 <sup>th</sup>, 2011):
	<ul>
		<li>Compiled against .NET3.5</li>
	</ul></li>
</ul>
<ul>
	<li><strong>0.3.0</strong> (June 16 <sup>th</sup>, 2011):
	<ul>
		<li>Changed file caching mechanism.  Files only re-written if their contents change.  Thanks to <a href="https://github.com/edazdarevic">edazdarevic</a> for the idea.</li>
	</ul></li>
</ul>
<ul>
	<li><strong>0.2.1</strong> (June 8 <sup>th</sup>, 2011):
	<ul>
		<li><code>IBale.Attr</code> now supports adding attributes with no value such as <code>async</code> or <code>defer</code></li>
	</ul></li>
</ul>
<ul>
	<li><strong>0.2.0</strong> (June 8 <sup>th</sup>, 2011):
	<ul>
		<li>Added <code>IBale.Attr(string name, string value)</code> for adding custom attributes to the bales output tag.</li>
	</ul></li>
</ul>
<ul>
	<li><strong>0.1.0</strong> (May 31 <sup>st</sup>, 2011):
	<ul>
		<li>Initial alpha release.</li>
	</ul></li>
</ul>
<h2 id="section_7">7 Contributors</h2>
<ul>
	<li>James Hughes (Developer, Project Leader)</li>
</ul>
<p>Want to help?  Fork the project, make some changes, even if it&#8217;s a single failing test, and submit a pull request.  Alternatively submit bugs, change requests or criticisms.</p>
<h2 id="section_8">8 License</h2>
<p>(The <span class="caps">MIT</span> License)</p>
<p>Copyright &copy; 2011 James Hughes</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &#8220;Software&#8221;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p><span class="caps">THE</span> <span class="caps">SOFTWARE</span> IS <span class="caps">PROVIDED</span> &#8220;AS IS&#8221;, <span class="caps">WITHOUT</span> <span class="caps">WARRANTY</span> OF <span class="caps">ANY</span> <span class="caps">KIND</span>, <span class="caps">EXPRESS</span> OR <span class="caps">IMPLIED</span>, <span class="caps">INCLUDING</span> <span class="caps">BUT</span> <span class="caps">NOT</span> <span class="caps">LIMITED</span> TO <span class="caps">THE</span> <span class="caps">WARRANTIES</span> OF <span class="caps">MERCHANTABILITY</span>, <span class="caps">FITNESS</span> <span class="caps">FOR</span> A <span class="caps">PARTICULAR</span> <span class="caps">PURPOSE</span> <span class="caps">AND</span> <span class="caps">NON</span> <span class="caps">INFRINGEMENT</span>. IN NO <span class="caps">EVENT</span> <span class="caps">SHALL</span> <span class="caps">THE</span> <span class="caps">AUTHORS</span> OR <span class="caps">COPYRIGHT</span> <span class="caps">HOLDERS</span> BE <span class="caps">LIABLE</span> <span class="caps">FOR</span> <span class="caps">ANY</span> <span class="caps">CLAIM</span>, <span class="caps">DAMAGES</span> OR <span class="caps">OTHER</span> <span class="caps">LIABILITY</span>, <span class="caps">WHETHER</span> IN AN <span class="caps">ACTION</span> OF <span class="caps">CONTRACT</span>, <span class="caps">TORT</span> OR <span class="caps">OTHERWISE</span>, <span class="caps">ARISING</span> <span class="caps">FROM</span>, <span class="caps">OUT</span> OF OR IN <span class="caps">CONNECTION</span> <span class="caps">WITH</span> <span class="caps">THE</span> <span class="caps">SOFTWARE</span> OR <span class="caps">THE</span> <span class="caps">USE</span> OR <span class="caps">OTHER</span> <span class="caps">DEALINGS</span> IN <span class="caps">THE</span> <span class="caps">SOFTWARE</span>.</p>

      </div>
      
    </body>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-19143623-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</html>